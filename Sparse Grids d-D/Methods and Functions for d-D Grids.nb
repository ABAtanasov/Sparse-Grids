(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 10.4' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[    104629,       2610]
NotebookOptionsPosition[    102853,       2546]
NotebookOutlinePosition[    103212,       2562]
CellTagsIndexPosition[    103169,       2559]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["Standard Definitions", "Subsection",
 CellChangeTimes->{{3.673277052290266*^9, 3.6732770726158047`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"\[Phi]", "[", "x_", "]"}], ":=", 
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"Abs", "[", "x", "]"}], ">", "1"}], ",", "0", ",", 
    RowBox[{"1", "-", 
     RowBox[{"Abs", "[", "x", "]"}]}]}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Phi]", "[", 
   RowBox[{"l_Integer", ",", "i_Integer"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"l", "\[Equal]", 
      RowBox[{"-", "1"}]}], ",", "1", ",", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"l", "\[Equal]", "0"}], ",", "#", ",", 
       RowBox[{"\[Phi]", "[", 
        RowBox[{
         SuperscriptBox["2", "l"], 
         RowBox[{"(", 
          RowBox[{"#", "-", 
           RowBox[{
            SuperscriptBox["2", 
             RowBox[{"-", "l"}]], 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"2", "i"}], "-", "1"}], ")"}]}]}], ")"}]}], "]"}]}], 
      "]"}]}], "]"}], "&"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Phi]", "[", 
   RowBox[{"lx_", ",", "ly_", ",", "i_", ",", "j_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"\[Phi]", "[", 
      RowBox[{"lx", ",", "i"}], "]"}], "[", "#1", "]"}], 
    RowBox[{
     RowBox[{"\[Phi]", "[", 
      RowBox[{"ly", ",", "j"}], "]"}], "[", "#2", "]"}]}], 
   "&"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Phi]", "[", 
   RowBox[{"l_List", ",", "i_List"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"Product", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"\[Phi]", "[", 
       RowBox[{
        RowBox[{"l", "[", 
         RowBox[{"[", "d", "]"}], "]"}], ",", 
        RowBox[{"i", "[", 
         RowBox[{"[", "d", "]"}], "]"}]}], "]"}], "[", 
      RowBox[{"#", "[", 
       RowBox[{"[", "d", "]"}], "]"}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"d", ",", "1", ",", 
       RowBox[{"Length", "[", "l", "]"}]}], "}"}]}], "]"}], "&"}]}], "\n", 
 RowBox[{
  RowBox[{"\[Psi]", "[", 
   RowBox[{"l_", ",", "i_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"\[Phi]", "[", 
    RowBox[{
     SuperscriptBox["2", "l"], 
     RowBox[{"(", 
      RowBox[{"#1", "-", 
       RowBox[{
        SuperscriptBox["2", 
         RowBox[{"-", "l"}]], "i"}]}], ")"}]}], "]"}], "&"}]}], "\n", 
 RowBox[{
  RowBox[{"\[Psi]", "[", 
   RowBox[{"lx_", ",", "ly_", ",", "i_", ",", "j_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"\[Phi]", "[", 
     RowBox[{
      SuperscriptBox["2", "lx"], 
      RowBox[{"(", 
       RowBox[{"#1", "-", 
        RowBox[{
         SuperscriptBox["2", 
          RowBox[{"-", "lx"}]], "i"}]}], ")"}]}], "]"}], 
    RowBox[{"\[Phi]", "[", 
     RowBox[{
      SuperscriptBox["2", "ly"], 
      RowBox[{"(", 
       RowBox[{"#2", "-", 
        RowBox[{
         SuperscriptBox["2", 
          RowBox[{"-", "ly"}]], "j"}]}], ")"}]}], "]"}]}], 
   "&"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"\[Psi]", "[", 
    RowBox[{"l_List", ",", "i_List"}], "]"}], ":=", 
   RowBox[{
    RowBox[{"Product", "[", 
     RowBox[{
      RowBox[{"\[Phi]", "[", 
       RowBox[{
        SuperscriptBox["2", 
         RowBox[{"l", "[", 
          RowBox[{"[", "d", "]"}], "]"}]], 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"#", "[", 
           RowBox[{"[", "d", "]"}], "]"}], "-", 
          RowBox[{
           SuperscriptBox["2", 
            RowBox[{"-", 
             RowBox[{"l", "[", 
              RowBox[{"[", "d", "]"}], "]"}]}]], 
           RowBox[{"i", "[", 
            RowBox[{"[", "d", "]"}], "]"}]}]}], ")"}]}], "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"d", ",", "1", ",", 
        RowBox[{"Length", "[", "l", "]"}]}], "}"}]}], "]"}], "&"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"proj", "[", 
    RowBox[{"f_", ",", "x_"}], "]"}], ":=", 
   RowBox[{
    RowBox[{"f", "[", 
     RowBox[{"Join", "[", 
      RowBox[{"#", ",", 
       RowBox[{"{", "x", "}"}]}], "]"}], "]"}], "&"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"ceil", "[", 
   RowBox[{"x_", ",", "l_Integer"}], "]"}], ":=", 
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{"x", "\[GreaterEqual]", "1"}], ",", 
    SuperscriptBox["2", 
     RowBox[{"l", "-", "1"}]], ",", 
    RowBox[{"1", "+", 
     RowBox[{"Floor", "[", 
      RowBox[{
       SuperscriptBox["2", 
        RowBox[{"l", "-", "1"}]], "x"}], "]"}]}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ceil", "[", 
    RowBox[{"x_List", ",", "l_List"}], "]"}], ":=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"x", "[", 
         RowBox[{"[", "i", "]"}], "]"}], "\[GreaterEqual]", "1"}], ",", 
       SuperscriptBox["2", 
        RowBox[{
         RowBox[{"l", "[", 
          RowBox[{"[", "i", "]"}], "]"}], "-", "1"}]], ",", 
       RowBox[{"1", "+", 
        RowBox[{"Floor", "[", 
         RowBox[{
          SuperscriptBox["2", 
           RowBox[{
            RowBox[{"l", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "-", "1"}]], 
          RowBox[{"x", "[", 
           RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}]}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", 
       RowBox[{"Length", "[", "x", "]"}]}], "}"}]}], "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"atPosition", "[", 
    RowBox[{"x_List", ",", "l_List", ",", "i_List"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"j", ",", "prod", ",", "xpos"}], "}"}], ",", 
     RowBox[{
      RowBox[{"xpos", "=", 
       RowBox[{"ceil", "[", 
        RowBox[{"x", ",", "l"}], "]"}]}], ";", "\n", "\t\t\t\t\t\t\t\t\t\t\t", 
      RowBox[{"prod", "=", 
       RowBox[{"Product", "[", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"xpos", "[", 
              RowBox[{"[", "j", "]"}], "]"}], "==", 
             RowBox[{"i", "[", 
              RowBox[{"[", "j", "]"}], "]"}]}], " ", "||", " ", 
            RowBox[{
             RowBox[{"l", "[", 
              RowBox[{"[", "j", "]"}], "]"}], "<", "1"}]}], ",", "1", ",", 
           "0"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"j", ",", "1", ",", 
           RowBox[{"Length", "[", "x", "]"}]}], "}"}]}], "]"}]}], ";", "\n", 
      "\t\t\t\t\t\t\t\t\t\t\t", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"prod", "\[Equal]", "1"}], ",", 
        RowBox[{
         RowBox[{"Return", "[", "True", "]"}], ";"}], ",", 
        RowBox[{
         RowBox[{"Return", "[", "False", "]"}], ";"}]}], "]"}], ";"}]}], 
    "]"}]}], "\n", 
  RowBox[{"(*", 
   RowBox[{
   "Perhaps", " ", "this", " ", "could", " ", "be", " ", "made", " ", "more", 
    " ", "efficient"}], "*)"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"switch", "[", "x_", "]"}], ":=", 
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{"x", "\[GreaterEqual]", "1"}], ",", "x", ",", "1"}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"switch2", "[", "x_", "]"}], ":=", 
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{"x", "\[Equal]", 
     RowBox[{"-", "1"}]}], ",", "0", ",", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"x", "\[Equal]", "0"}], ",", "1", ",", 
      SuperscriptBox["2", 
       RowBox[{"-", "x"}]]}], "]"}]}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"switch3", "[", 
    RowBox[{"x_", ",", "i_"}], "]"}], ":=", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"x", "\[LessEqual]", "0"}], ",", "1", ",", 
     RowBox[{
      SuperscriptBox[
       RowBox[{"(", 
        RowBox[{"-", "1"}], ")"}], 
       RowBox[{"i", "+", "1"}]], 
      SuperscriptBox["2", 
       RowBox[{"-", "x"}]]}]}], "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"area", "[", "kx_", "]"}], ":=", 
   RowBox[{"Which", "[", 
    RowBox[{
     RowBox[{"kx", "\[Equal]", 
      RowBox[{"-", "1"}]}], ",", "1", ",", 
     RowBox[{"kx", "\[Equal]", "0"}], ",", 
     RowBox[{"1", "/", "2"}], ",", 
     RowBox[{"kx", ">", "0"}], ",", 
     SuperscriptBox["2", 
      RowBox[{"-", "kx"}]]}], "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"column2", "[", 
   RowBox[{"diag_", ",", "row_"}], "]"}], ":=", 
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{"diag", "<", "1"}], ",", "diag", ",", " ", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"row", "<", "1"}], ",", "diag", ",", 
      RowBox[{"diag", "-", "row", "+", "1"}]}], "]"}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"column1", "[", 
    RowBox[{"diag_", ",", "row_"}], "]"}], ":=", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"diag", "\[Equal]", "row"}], ",", 
     RowBox[{"-", "1"}], ",", 
     RowBox[{"column2", "[", 
      RowBox[{"diag", ",", "row"}], "]"}]}], "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"getrow", "[", 
   RowBox[{"perp_", ",", "diag_"}], "]"}], ":=", 
  RowBox[{"Which", "[", 
   RowBox[{
    RowBox[{"diag", "\[Equal]", 
     RowBox[{"-", "1"}]}], ",", 
    RowBox[{"-", "1"}], ",", 
    RowBox[{"diag", "\[Equal]", "0"}], ",", 
    RowBox[{"Min", "[", 
     RowBox[{"perp", ",", "0"}], "]"}], ",", 
    RowBox[{"perp", "\[LessEqual]", "diag"}], ",", "perp", ",", "True", ",", 
    "diag"}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"getcol", "[", 
    RowBox[{"perp_", ",", "diag_"}], "]"}], ":=", 
   RowBox[{"Which", "[", 
    RowBox[{
     RowBox[{"diag", "\[Equal]", 
      RowBox[{"-", "1"}]}], ",", 
     RowBox[{"-", "1"}], ",", 
     RowBox[{"diag", "\[Equal]", "0"}], ",", 
     RowBox[{"Min", "[", 
      RowBox[{
       RowBox[{"diag", "-", "perp"}], ",", "0"}], "]"}], ",", 
     RowBox[{"perp", ">", " ", "0"}], ",", 
     RowBox[{"diag", "-", "perp"}], ",", "True", ",", "diag"}], "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"endperp", "[", "n_", "]"}], ":=", 
   RowBox[{"Which", "[", 
    RowBox[{
     RowBox[{"n", "\[Equal]", 
      RowBox[{"-", "1"}]}], ",", 
     RowBox[{"-", "1"}], ",", 
     RowBox[{"n", "\[Equal]", "0"}], ",", "1", ",", "True", ",", 
     RowBox[{"n", "+", "1"}]}], "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"d\[Phi]", "[", "x_", "]"}], ":=", 
  RowBox[{"Which", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"Abs", "[", "x", "]"}], ">", "1"}], ",", "0", ",", 
    "\[IndentingNewLine]", "\t\t\t", 
    RowBox[{"x", "\[Equal]", "1"}], " ", ",", 
    RowBox[{
     RowBox[{"-", "1"}], "/", "2"}], ",", "\[IndentingNewLine]", "\t\t\t", 
    RowBox[{"x", "\[Equal]", 
     RowBox[{"-", "1"}]}], ",", 
    RowBox[{"1", "/", "2"}], ",", "\[IndentingNewLine]", "\t\t\t", 
    RowBox[{"x", "\[Equal]", "0"}], ",", "0", ",", "\[IndentingNewLine]", 
    "\t\t\t", 
    RowBox[{"x", ">", "0"}], ",", 
    RowBox[{"-", "1"}], ",", "\[IndentingNewLine]", "\t\t\t", "True", ",", 
    "1"}], "]"}], 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"Don", "'"}], "t", " ", "think", " ", "I", " ", "need", " ", 
    "this"}], "*)"}]}]}], "Code",
 InitializationCell->False,
 CellChangeTimes->{{3.6744811910313263`*^9, 3.674481194403453*^9}, {
   3.6744812376085663`*^9, 3.674481250630253*^9}, {3.674481287478826*^9, 
   3.674481397496801*^9}, {3.674481428875256*^9, 3.67448150801718*^9}, {
   3.67448167340905*^9, 3.674481675421351*^9}, {3.674481730384124*^9, 
   3.6744817373030787`*^9}, {3.674481790136471*^9, 3.674481791034795*^9}, {
   3.674484274994933*^9, 3.67448427677055*^9}, {3.674484437553482*^9, 
   3.674484437988184*^9}, {3.6744844734702044`*^9, 3.674484485512768*^9}, {
   3.674484559759901*^9, 3.674484561696947*^9}, 3.674484594091449*^9, {
   3.674484679915069*^9, 3.6744846812889137`*^9}, {3.674484736466405*^9, 
   3.6744847768624783`*^9}, {3.6744848709161177`*^9, 
   3.6744848731735783`*^9}, {3.674486262874626*^9, 3.674486299690905*^9}, {
   3.6744863501670237`*^9, 3.674486351045779*^9}, {3.6744866023345623`*^9, 
   3.674486632892457*^9}, {3.674487560511071*^9, 3.6744875793767223`*^9}, {
   3.6747523971858273`*^9, 3.6747523977206097`*^9}, {3.674769687662139*^9, 
   3.674769688227778*^9}, {3.674783090964974*^9, 3.674783093116194*^9}, {
   3.674840811053302*^9, 3.674840843477468*^9}, {3.6748410045042458`*^9, 
   3.674841015073327*^9}, {3.674841616288641*^9, 3.674841635345583*^9}, {
   3.674842853715324*^9, 3.674842865856686*^9}, 3.674842915994318*^9, {
   3.674910160787148*^9, 3.674910335643365*^9}, {3.674910892318142*^9, 
   3.67491092435188*^9}, {3.675121425838121*^9, 3.675121428139786*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Standard Lagrange Basis", "Subsection",
 CellChangeTimes->{{3.673277052290266*^9, 3.673277056255988*^9}, {
   3.673367982176783*^9, 3.6733679845358677`*^9}, 3.673643134677516*^9, {
   3.6748435383575287`*^9, 3.674843539263554*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"standardCoefficients", "[", 
    RowBox[{"f_", ",", "l_List"}], "]"}], ":=", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"Length", "[", "l", "]"}], "\[Equal]", "1"}], ",", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"f", "[", 
        RowBox[{"{", 
         RowBox[{"j", " ", 
          SuperscriptBox["2", 
           RowBox[{"-", 
            RowBox[{"l", "[", 
             RowBox[{"[", "1", "]"}], "]"}]}]]}], "}"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"j", ",", "0", ",", 
         SuperscriptBox["2", 
          RowBox[{"l", "[", 
           RowBox[{"[", "1", "]"}], "]"}]]}], "}"}]}], "]"}], ",", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"standardCoefficients", "[", 
        RowBox[{
         RowBox[{"proj", "[", 
          RowBox[{"f", ",", 
           RowBox[{"j", " ", 
            SuperscriptBox["2", 
             RowBox[{"-", 
              RowBox[{"l", "[", 
               RowBox[{"[", 
                RowBox[{"-", "1"}], "]"}], "]"}]}]]}]}], "]"}], ",", 
         RowBox[{"l", "[", 
          RowBox[{"[", 
           RowBox[{";;", 
            RowBox[{"-", "2"}]}], "]"}], "]"}]}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"j", ",", "0", ",", 
         SuperscriptBox["2", 
          RowBox[{"l", "[", 
           RowBox[{"[", 
            RowBox[{"-", "1"}], "]"}], "]"}]]}], "}"}]}], "]"}]}], "]"}]}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", "Working", "*)"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"standardReconstruct", "[", 
    RowBox[{"coefficients_", ",", "l_List", ",", "x_List"}], "]"}], ":=", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"Length", "[", "l", "]"}], "\[Equal]", "1"}], ",", 
     RowBox[{"Sum", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"coefficients", "[", 
         RowBox[{"[", 
          RowBox[{"i", "+", "1"}], "]"}], "]"}], "  ", 
        RowBox[{
         RowBox[{"\[Psi]", "[", 
          RowBox[{
           RowBox[{"l", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", "i"}], "]"}], " ", "[", 
         RowBox[{"x", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "0", ",", 
         SuperscriptBox["2", 
          RowBox[{"l", "[", 
           RowBox[{"[", "1", "]"}], "]"}]]}], "}"}]}], "]"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"Sum", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"standardReconstruct", "[", 
         RowBox[{
          RowBox[{"coefficients", "[", 
           RowBox[{"[", 
            RowBox[{"i", "+", "1"}], "]"}], "]"}], ",", 
          RowBox[{"l", "[", 
           RowBox[{"[", 
            RowBox[{";;", 
             RowBox[{"-", "2"}]}], "]"}], "]"}], ",", 
          RowBox[{"x", "[", 
           RowBox[{"[", 
            RowBox[{";;", 
             RowBox[{"-", "2"}]}], "]"}], "]"}]}], "]"}], " ", 
        RowBox[{
         RowBox[{"\[Psi]", "[", 
          RowBox[{
           RowBox[{"l", "[", 
            RowBox[{"[", 
             RowBox[{"-", "1"}], "]"}], "]"}], ",", "i"}], "]"}], " ", "[", 
         RowBox[{"x", "[", 
          RowBox[{"[", 
           RowBox[{"-", "1"}], "]"}], "]"}], "]"}]}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "0", ",", 
         SuperscriptBox["2", 
          RowBox[{"l", "[", 
           RowBox[{"[", "1", "]"}], "]"}]]}], "}"}]}], "]"}]}], 
    "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
   "The", " ", "hierarchical", " ", "and", " ", "sparse", " ", "basis", " ", 
    "will", " ", "be", " ", "more", " ", "efficient"}], "*)"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"standardProject", "[", 
   RowBox[{"f_", ",", "l_List", ",", "x_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "}"}], ",", 
    RowBox[{
     RowBox[{"coeffs", "=", 
      RowBox[{"standardCoefficients", "[", 
       RowBox[{"f", ",", "l"}], "]"}]}], ";", 
     RowBox[{"Return", "[", 
      RowBox[{"standardReconstruct", "[", 
       RowBox[{"coeffs", ",", "l", ",", "x"}], "]"}], "]"}], ";"}]}], 
   "]"}]}]}], "Input",
 CellChangeTimes->{{3.6733680003972816`*^9, 3.6733681189558687`*^9}, {
   3.673370933680094*^9, 3.673370994522457*^9}, {3.673371036059031*^9, 
   3.6733711201950502`*^9}, {3.6733711714335012`*^9, 3.673371175445512*^9}, {
   3.673371413375792*^9, 3.673371423930414*^9}, {3.6733715870924797`*^9, 
   3.673371621567006*^9}, {3.673371658601623*^9, 3.673371665146308*^9}, {
   3.673617918986994*^9, 3.6736179378880987`*^9}, {3.67361801388404*^9, 
   3.6736180150769053`*^9}, {3.67362175928094*^9, 3.673621761032077*^9}, {
   3.673803992943742*^9, 3.673804011118949*^9}, {3.674484924281612*^9, 
   3.674484968686173*^9}, {3.674485004800501*^9, 3.674485036126503*^9}, {
   3.674485663088119*^9, 3.6744857011484747`*^9}, {3.674485737961299*^9, 
   3.674485743778206*^9}, {3.674485877793128*^9, 3.6744858986747007`*^9}, {
   3.67448593962906*^9, 3.674485955942828*^9}, {3.6744866431711884`*^9, 
   3.6744866534458723`*^9}, {3.674486685114644*^9, 3.6744867151388817`*^9}, {
   3.67448687455191*^9, 3.67448694918801*^9}, {3.6744871835987*^9, 
   3.674487239971493*^9}, {3.674487274980289*^9, 3.674487313552134*^9}, {
   3.674487344534745*^9, 3.6744873464087467`*^9}, {3.674487381814568*^9, 
   3.674487382067174*^9}, {3.674487422986845*^9, 3.674487423124476*^9}, {
   3.6744877149023323`*^9, 3.674487717233553*^9}, {3.674488930982853*^9, 
   3.674489010254053*^9}, {3.674489048483533*^9, 3.6744892231032333`*^9}, 
   3.674489290246028*^9, {3.674489412439065*^9, 3.674489412809019*^9}, {
   3.674493418630106*^9, 3.674493420452162*^9}, {3.6747525666820517`*^9, 
   3.674752722950457*^9}, {3.674752756985376*^9, 3.674752815215446*^9}, {
   3.674752941329452*^9, 3.674752951281733*^9}, {3.674753032938027*^9, 
   3.67475313638207*^9}, {3.674753179926672*^9, 3.6747532657848997`*^9}, {
   3.674753642373252*^9, 3.674753644908835*^9}, {3.6747537368600693`*^9, 
   3.6747537550207167`*^9}, {3.674753795756542*^9, 3.6747538085116043`*^9}, {
   3.674754299695311*^9, 3.6747544597596292`*^9}, {3.6747544939485207`*^9, 
   3.6747544941052923`*^9}, {3.674759429682479*^9, 3.6747594461759577`*^9}, {
   3.6748434357984867`*^9, 3.674843452468148*^9}, 3.6748435415433893`*^9, {
   3.67516337559895*^9, 3.675163376184517*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Hierarchical Iteration in n-D", "Subsection",
 CellChangeTimes->{{3.673277052290266*^9, 3.673277056255988*^9}, {
  3.67357648054101*^9, 3.673576481088376*^9}, {3.674843506874929*^9, 
  3.674843513409747*^9}, {3.6751209956073503`*^9, 3.675120996314949*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"hierIterate", "[", 
    RowBox[{"l_List", ",", "ki_List"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"k", ",", "i", ",", "hashEntry", ",", "hashMap", ",", "count"}],
       "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"hashMap", "=", 
       RowBox[{"Table", "[", 
        RowBox[{"0", ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "0", ",", 
           SuperscriptBox["2", 
            RowBox[{
            "l", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]]}], 
          "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"count", "=", "1"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "l", "]"}], "\[Equal]", "1"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"For", "[", 
          RowBox[{
           RowBox[{"k", "=", 
            RowBox[{"-", "1"}]}], ",", 
           RowBox[{"k", "\[LessEqual]", 
            RowBox[{
            "l", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], 
           ",", 
           RowBox[{"k", "++"}], ",", "\[IndentingNewLine]", 
           RowBox[{"For", "[", 
            RowBox[{
             RowBox[{"i", "=", "1"}], ",", 
             RowBox[{"i", "\[LessEqual]", 
              SuperscriptBox["2", 
               RowBox[{
                RowBox[{"switch", "[", "k", "]"}], "-", "1"}]]}], ",", 
             RowBox[{"i", "++"}], ",", 
             RowBox[{
              RowBox[{"hashEntry", "=", 
               RowBox[{"Append", "[", 
                RowBox[{
                 RowBox[{"Append", "[", 
                  RowBox[{"ki", ",", 
                   RowBox[{"k", "+", "2"}]}], "]"}], ",", "i"}], "]"}]}], ";",
               "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"hashMap", "\[LeftDoubleBracket]", 
                RowBox[{"count", "++"}], "\[RightDoubleBracket]"}], "=", 
               "hashEntry"}], ";"}]}], "\[IndentingNewLine]", "]"}]}], "]"}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"Return", "[", 
          RowBox[{"Partition", "[", 
           RowBox[{
            RowBox[{"Flatten", "[", "hashMap", "]"}], ",", 
            RowBox[{"2", 
             RowBox[{"Length", "[", "l", "]"}]}]}], "]"}], "]"}], ";"}], 
        "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"For", "[", 
          RowBox[{
           RowBox[{"k", "=", 
            RowBox[{"-", "1"}]}], ",", 
           RowBox[{"k", "\[LessEqual]", 
            RowBox[{"l", "[", 
             RowBox[{"[", "1", "]"}], "]"}]}], ",", 
           RowBox[{"k", "++"}], ",", "\[IndentingNewLine]", 
           RowBox[{"For", "[", 
            RowBox[{
             RowBox[{"i", "=", "1"}], ",", 
             RowBox[{"i", "\[LessEqual]", 
              SuperscriptBox["2", 
               RowBox[{
                RowBox[{"switch", "[", "k", "]"}], "-", "1"}]]}], ",", 
             RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"hashEntry", "=", 
               RowBox[{"hierIterate", "[", 
                RowBox[{
                 RowBox[{"l", "[", 
                  RowBox[{"[", 
                   RowBox[{"2", ";;"}], "]"}], "]"}], ",", 
                 RowBox[{"Append", "[", 
                  RowBox[{
                   RowBox[{"Append", "[", 
                    RowBox[{"ki", ",", 
                    RowBox[{"k", "+", "2"}]}], "]"}], ",", "i"}], "]"}]}], 
                "]"}]}], ";", 
              RowBox[{
               RowBox[{"hashMap", "\[LeftDoubleBracket]", 
                RowBox[{"count", "++"}], "\[RightDoubleBracket]"}], "=", 
               "hashEntry"}]}]}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
         
         RowBox[{"Return", "[", 
          RowBox[{"Partition", "[", 
           RowBox[{
            RowBox[{"Flatten", "[", "hashMap", "]"}], ",", 
            RowBox[{"2", 
             RowBox[{"Length", "[", "l", "]"}]}]}], "]"}], "]"}], ";"}]}], 
       "\[IndentingNewLine]", "]"}]}]}], "]"}]}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"This", " ", "is", " ", "working"}], "*)"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"hierIterate", "[", "l_List", "]"}], ":=", 
  RowBox[{"hierIterate", "[", 
   RowBox[{"l", ",", 
    RowBox[{"{", "}"}]}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"This", " ", "is", " ", "working"}], "*)"}]}]}], "Input",
 CellChangeTimes->{{3.674916236841626*^9, 3.674916236856056*^9}, {
   3.6751225934679747`*^9, 3.675122609547325*^9}, {3.6752910096637506`*^9, 
   3.675291145362281*^9}, {3.675291197972911*^9, 3.675291220839794*^9}, {
   3.6752912675848703`*^9, 3.675291273287323*^9}, 3.675291343458435*^9, {
   3.675291579410098*^9, 3.675291580248117*^9}, {3.675725293700748*^9, 
   3.6757253122192173`*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Getting Hierarchical Coefficients", "Subsection",
 CellChangeTimes->{{3.673277052290266*^9, 3.673277056255988*^9}, {
  3.67357648054101*^9, 3.673576481088376*^9}, {3.674843528012055*^9, 
  3.6748435336967697`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"getCoefficient", "[", 
    RowBox[{"f_", ",", "x_List", ",", "l_List"}], "]"}], ":=", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"Length", "[", "l", "]"}], "\[Equal]", "1"}], ",", 
     RowBox[{"Which", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"l", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", 
        RowBox[{"-", "1"}]}], ",", 
       RowBox[{"f", "[", 
        RowBox[{"{", "0", "}"}], "]"}], ",", 
       RowBox[{
        RowBox[{"l", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "0"}], ",", 
       RowBox[{
        RowBox[{"f", "[", 
         RowBox[{"{", "1", "}"}], "]"}], "-", 
        RowBox[{"f", "[", 
         RowBox[{"{", "0", "}"}], "]"}]}], ",", "True", ",", 
       RowBox[{
        RowBox[{"f", "[", "x", "]"}], "-", 
        RowBox[{
         RowBox[{"1", "/", "2"}], " ", 
         RowBox[{"f", "[", 
          RowBox[{"x", "+", 
           RowBox[{"2", "^", 
            RowBox[{"-", 
             RowBox[{"l", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}]}]}], "]"}]}], "-", 
        RowBox[{
         RowBox[{"1", "/", "2"}], " ", 
         RowBox[{"f", "[", 
          RowBox[{"x", "-", 
           RowBox[{"2", "^", 
            RowBox[{"-", 
             RowBox[{"l", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}]}]}], "]"}]}]}]}], "]"}], ",", 
     "\[IndentingNewLine]", "\t\t\t\t", 
     RowBox[{"Which", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"l", "[", 
         RowBox[{"[", 
          RowBox[{"-", "1"}], "]"}], "]"}], "\[Equal]", 
        RowBox[{"-", "1"}]}], ",", 
       RowBox[{"getCoefficient", "[", 
        RowBox[{
         RowBox[{"proj", "[", 
          RowBox[{"f", ",", "0"}], "]"}], ",", 
         RowBox[{"x", "[", 
          RowBox[{"[", 
           RowBox[{";;", 
            RowBox[{"-", "2"}]}], "]"}], "]"}], ",", 
         RowBox[{"l", "[", 
          RowBox[{"[", 
           RowBox[{";;", 
            RowBox[{"-", "2"}]}], "]"}], "]"}]}], "]"}], ",", 
       "\[IndentingNewLine]", "\t\t\t\t\t", 
       RowBox[{
        RowBox[{"l", "[", 
         RowBox[{"[", 
          RowBox[{"-", "1"}], "]"}], "]"}], "\[Equal]", "0"}], ",", 
       RowBox[{
        RowBox[{"getCoefficient", "[", 
         RowBox[{
          RowBox[{"proj", "[", 
           RowBox[{"f", ",", "1"}], "]"}], ",", 
          RowBox[{"x", "[", 
           RowBox[{"[", 
            RowBox[{";;", 
             RowBox[{"-", "2"}]}], "]"}], "]"}], ",", 
          RowBox[{"l", "[", 
           RowBox[{"[", 
            RowBox[{";;", 
             RowBox[{"-", "2"}]}], "]"}], "]"}]}], "]"}], "-", 
        RowBox[{"getCoefficient", "[", 
         RowBox[{
          RowBox[{"proj", "[", 
           RowBox[{"f", ",", "0"}], "]"}], ",", 
          RowBox[{"x", "[", 
           RowBox[{"[", 
            RowBox[{";;", 
             RowBox[{"-", "2"}]}], "]"}], "]"}], ",", 
          RowBox[{"l", "[", 
           RowBox[{"[", 
            RowBox[{";;", 
             RowBox[{"-", "2"}]}], "]"}], "]"}]}], "]"}]}], ",", 
       "\[IndentingNewLine]", "\t\t\t\t\t", "True", ",", 
       RowBox[{
        RowBox[{"getCoefficient", "[", 
         RowBox[{
          RowBox[{"proj", "[", 
           RowBox[{"f", ",", 
            RowBox[{"x", "[", 
             RowBox[{"[", 
              RowBox[{"-", "1"}], "]"}], "]"}]}], "]"}], ",", 
          RowBox[{"x", "[", 
           RowBox[{"[", 
            RowBox[{";;", 
             RowBox[{"-", "2"}]}], "]"}], "]"}], ",", 
          RowBox[{"l", "[", 
           RowBox[{"[", 
            RowBox[{";;", 
             RowBox[{"-", "2"}]}], "]"}], "]"}]}], "]"}], "-", 
        RowBox[{
         RowBox[{"1", "/", "2"}], " ", 
         RowBox[{"getCoefficient", "[", 
          RowBox[{
           RowBox[{"proj", "[", 
            RowBox[{"f", ",", 
             RowBox[{
              RowBox[{"x", "[", 
               RowBox[{"[", 
                RowBox[{"-", "1"}], "]"}], "]"}], "+", 
              SuperscriptBox["2", 
               RowBox[{"-", 
                RowBox[{"l", "[", 
                 RowBox[{"[", 
                  RowBox[{"-", "1"}], "]"}], "]"}]}]]}]}], "]"}], ",", 
           RowBox[{"x", "[", 
            RowBox[{"[", 
             RowBox[{";;", 
              RowBox[{"-", "2"}]}], "]"}], "]"}], ",", 
           RowBox[{"l", "[", 
            RowBox[{"[", 
             RowBox[{";;", 
              RowBox[{"-", "2"}]}], "]"}], "]"}]}], "]"}]}], "-", 
        RowBox[{
         RowBox[{"1", "/", "2"}], 
         RowBox[{"getCoefficient", "[", 
          RowBox[{
           RowBox[{"proj", "[", 
            RowBox[{"f", ",", 
             RowBox[{
              RowBox[{"x", "[", 
               RowBox[{"[", 
                RowBox[{"-", "1"}], "]"}], "]"}], "-", 
              SuperscriptBox["2", 
               RowBox[{"-", 
                RowBox[{"l", "[", 
                 RowBox[{"[", 
                  RowBox[{"-", "1"}], "]"}], "]"}]}]]}]}], "]"}], ",", 
           RowBox[{"x", "[", 
            RowBox[{"[", 
             RowBox[{";;", 
              RowBox[{"-", "2"}]}], "]"}], "]"}], ",", 
           RowBox[{"l", "[", 
            RowBox[{"[", 
             RowBox[{";;", 
              RowBox[{"-", "2"}]}], "]"}], "]"}]}], "]"}]}]}]}], 
      "\[IndentingNewLine]", "\t\t\t\t", "]"}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"pointIndex", "[", 
   RowBox[{"x_", ",", "l_Integer"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "}"}], ",", 
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"k", "\[LessEqual]", "1"}], ",", "1", ",", 
        RowBox[{"ceil", "[", 
         RowBox[{"x", ",", "k"}], "]"}]}], "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"k", ",", 
        RowBox[{"-", "1"}], ",", "l"}], "}"}]}], "]"}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"pointIndex", "[", 
   RowBox[{"x_List", ",", "l_List"}], "]"}], ":=", 
  RowBox[{"Table", "[", 
   RowBox[{
    RowBox[{"pointIndex", "[", 
     RowBox[{
      RowBox[{"x", "[", 
       RowBox[{"[", "i", "]"}], "]"}], ",", 
      RowBox[{"l", "[", 
       RowBox[{"[", "i", "]"}], "]"}]}], "]"}], ",", 
    RowBox[{"{", 
     RowBox[{"i", ",", "1", ",", 
      RowBox[{"Length", "[", "l", "]"}]}], "}"}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"spointIndex", "[", 
   RowBox[{"x_List", ",", "n_Integer"}], "]"}], ":=", 
  RowBox[{"Table", "[", 
   RowBox[{
    RowBox[{"pointIndex", "[", 
     RowBox[{
      RowBox[{"x", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
      ",", "n"}], "]"}], ",", 
    RowBox[{"{", 
     RowBox[{"i", ",", "1", ",", 
      RowBox[{"Length", "[", "x", "]"}]}], "}"}]}], 
   "]"}]}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.672497905249762*^9, 3.6724980460804987`*^9}, {
   3.672498086010971*^9, 3.672498086426568*^9}, {3.672498120610044*^9, 
   3.672498132168372*^9}, {3.6724981933241796`*^9, 3.6724982357720547`*^9}, {
   3.672498276279566*^9, 3.672498326466967*^9}, {3.672498396348793*^9, 
   3.672498474897173*^9}, {3.67249856256668*^9, 3.6724985772347393`*^9}, {
   3.672498885753086*^9, 3.6724988887908688`*^9}, {3.672498973735808*^9, 
   3.6724989750417128`*^9}, {3.672499010376442*^9, 3.672499028840345*^9}, {
   3.672499325454844*^9, 3.672499329989029*^9}, {3.672499410615137*^9, 
   3.672499411943338*^9}, {3.673034778920154*^9, 3.673034779751392*^9}, {
   3.67303878112294*^9, 3.673038789981296*^9}, {3.6730390939721413`*^9, 
   3.673039148248605*^9}, 3.673264987008442*^9, {3.673265302956407*^9, 
   3.673265412069075*^9}, 3.673265484744018*^9, {3.6732655859770203`*^9, 
   3.673265599390531*^9}, {3.673549789331839*^9, 3.673549792474326*^9}, {
   3.673549937783786*^9, 3.673550067559483*^9}, {3.673550130904303*^9, 
   3.673550188655244*^9}, {3.673550222539015*^9, 3.673550263661482*^9}, {
   3.673550377429068*^9, 3.673550605255698*^9}, {3.673550658843258*^9, 
   3.673550674368505*^9}, {3.673550721880124*^9, 3.673550733630953*^9}, {
   3.6735508024880533`*^9, 3.6735508208972387`*^9}, {3.673551354349574*^9, 
   3.673551396733061*^9}, {3.673551464740687*^9, 3.67355147329633*^9}, {
   3.673551584855508*^9, 3.673551634805602*^9}, {3.673551685006486*^9, 
   3.673551707024789*^9}, {3.6735517673505163`*^9, 3.6735517949923353`*^9}, {
   3.6735518410399*^9, 3.673551856586239*^9}, {3.673552424760128*^9, 
   3.673552441686385*^9}, {3.6735528116472397`*^9, 3.673552820772859*^9}, {
   3.673553485545643*^9, 3.673553494259479*^9}, {3.6735535318168592`*^9, 
   3.67355353200189*^9}, {3.673553604649831*^9, 3.673553647805532*^9}, {
   3.673553784064872*^9, 3.673553853609994*^9}, {3.673554166480525*^9, 
   3.6735541678554363`*^9}, {3.673554200527424*^9, 3.673554201829867*^9}, {
   3.673554251115727*^9, 3.673554282927092*^9}, {3.6735543333531923`*^9, 
   3.673554340509158*^9}, {3.6735543940457973`*^9, 3.6735544556685667`*^9}, {
   3.673554497906698*^9, 3.673554498898905*^9}, {3.673576494836705*^9, 
   3.673576499717845*^9}, 3.6735765366015453`*^9, {3.673618128943383*^9, 
   3.673618130973936*^9}, {3.673619092051015*^9, 3.67361912676166*^9}, {
   3.673620420351119*^9, 3.673620496933251*^9}, {3.673620881831188*^9, 
   3.673620882921871*^9}, {3.673620949180478*^9, 3.6736210125382423`*^9}, {
   3.673621431465794*^9, 3.6736214391143417`*^9}, {3.6736215581179047`*^9, 
   3.6736215599219103`*^9}, {3.673621636818694*^9, 3.673621651195643*^9}, {
   3.673622841424548*^9, 3.6736228650698757`*^9}, 3.6736229433901*^9, {
   3.6736232301017036`*^9, 3.6736232463693113`*^9}, {3.673623282681774*^9, 
   3.67362328670819*^9}, 3.673623546299397*^9, {3.673624155189372*^9, 
   3.673624187683448*^9}, {3.673624259831815*^9, 3.673624287992454*^9}, {
   3.673624335560773*^9, 3.6736243654325733`*^9}, {3.673624615790103*^9, 
   3.6736246228422747`*^9}, {3.673624663960896*^9, 3.67362466708747*^9}, {
   3.673624820117755*^9, 3.6736249337957172`*^9}, {3.673625035903747*^9, 
   3.6736251121044083`*^9}, {3.6736253167153788`*^9, 
   3.6736253579904623`*^9}, {3.6736255302697477`*^9, 3.673625587758218*^9}, {
   3.673625691597685*^9, 3.67362571108678*^9}, {3.673625949932444*^9, 
   3.673625970469276*^9}, {3.673626294423847*^9, 3.673626308940868*^9}, {
   3.673626361145555*^9, 3.6736263813442917`*^9}, {3.673626612762067*^9, 
   3.673626642947071*^9}, 3.673627182248803*^9, {3.673627271199099*^9, 
   3.6736273004473343`*^9}, {3.673627575286366*^9, 3.673627582774056*^9}, {
   3.673630558590191*^9, 3.673630594039089*^9}, {3.673630834026103*^9, 
   3.673630835187813*^9}, {3.673634052909828*^9, 3.6736340758783207`*^9}, {
   3.673634114536069*^9, 3.673634152687709*^9}, {3.673641997399588*^9, 
   3.673642095416727*^9}, {3.673642167167782*^9, 3.6736421781509953`*^9}, {
   3.6736422248218727`*^9, 3.673642244356945*^9}, 3.67364312756176*^9, {
   3.6736454537836723`*^9, 3.6736454639501257`*^9}, {3.673784467451808*^9, 
   3.67378450842913*^9}, {3.6738040733758163`*^9, 3.673804077443865*^9}, {
   3.6738041119027452`*^9, 3.673804118531611*^9}, {3.673958523773306*^9, 
   3.673958523963352*^9}, {3.674392087039418*^9, 3.6743920978667593`*^9}, {
   3.674757363478085*^9, 3.6747573652273893`*^9}, {3.674757585360301*^9, 
   3.674757622305739*^9}, {3.674757723839777*^9, 3.674757800174861*^9}, {
   3.674757831864634*^9, 3.674757843753169*^9}, {3.674757974733378*^9, 
   3.674758010186563*^9}, {3.674758202976728*^9, 3.674758291503416*^9}, {
   3.674758396854774*^9, 3.674758448926877*^9}, {3.6747592086091003`*^9, 
   3.674759231141501*^9}, {3.674759288616119*^9, 3.6747593697074337`*^9}, {
   3.674759408485713*^9, 3.6747594198169737`*^9}, {3.674759546292395*^9, 
   3.674759588689645*^9}, {3.674759809945367*^9, 3.674759818298724*^9}, {
   3.674759884918996*^9, 3.674759890835333*^9}, 3.674759975638176*^9, {
   3.674760024844838*^9, 3.674760027526268*^9}, {3.674760146588223*^9, 
   3.674760147074807*^9}, {3.674760951552772*^9, 3.6747609721490917`*^9}, {
   3.674769126058444*^9, 3.674769354860641*^9}, {3.6747693883138742`*^9, 
   3.674769393373272*^9}, {3.674769485066435*^9, 3.674769517574822*^9}, {
   3.67476955927302*^9, 3.674769560324888*^9}, {3.674783020493692*^9, 
   3.674783027177895*^9}, {3.674783610531972*^9, 3.6747836701902113`*^9}, {
   3.6747837921988688`*^9, 3.674783824654852*^9}, {3.6747840856468077`*^9, 
   3.674784129080819*^9}, {3.674784165589798*^9, 3.6747841742060947`*^9}, 
   3.67478422727903*^9, {3.6747842893225727`*^9, 3.674784468584281*^9}, {
   3.674784574248002*^9, 3.674784576717916*^9}, {3.674784643419797*^9, 
   3.6747846469473963`*^9}, {3.674785042498074*^9, 3.674785047916299*^9}, {
   3.674785116753415*^9, 3.674785178469142*^9}, {3.6747852698409367`*^9, 
   3.6747852899987307`*^9}, {3.6747853332686*^9, 3.674785408211143*^9}, {
   3.67478545140729*^9, 3.674785453053021*^9}, {3.674785729435128*^9, 
   3.6747857637491713`*^9}, {3.674785936299008*^9, 3.6747859499141827`*^9}, {
   3.674786304909235*^9, 3.6747863129137287`*^9}, 3.6748230314219093`*^9, {
   3.674823979982181*^9, 3.6748239873859386`*^9}, {3.674824019791233*^9, 
   3.6748240199368067`*^9}, {3.674834040761581*^9, 3.674834086100503*^9}, {
   3.674834222228541*^9, 3.674834258714486*^9}, {3.674843424912375*^9, 
   3.6748434287623158`*^9}, {3.674843470042934*^9, 3.6748434819597683`*^9}, {
   3.6751212671451406`*^9, 3.675121314317782*^9}, {3.6751213667821608`*^9, 
   3.675121412579192*^9}, {3.6751214429799833`*^9, 3.6751214436803102`*^9}, {
   3.6751215702246513`*^9, 3.675121586505938*^9}, {3.675163636211279*^9, 
   3.67516363679985*^9}, {3.6753517790473833`*^9, 3.67535181989069*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Full Basis", "Subsection",
 CellChangeTimes->{{3.673277052290266*^9, 3.673277056255988*^9}, {
  3.67357648054101*^9, 3.673576481088376*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"fullCoefficients", "[", 
    RowBox[{"f_", ",", "l_List"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "li", ",", "x", ",", "i", ",", "k", ",", "diff", ",", "hash", ",", 
       "count"}], "}"}], ",", 
     RowBox[{
      RowBox[{"li", "=", 
       RowBox[{"hierIterate", "[", "l", "]"}]}], ";", 
      RowBox[{"hash", "=", 
       RowBox[{"Table", "[", 
        RowBox[{"0", ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", 
           RowBox[{"Length", "[", "li", "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"count", "=", "1"}], ";", "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"i", "=", "1"}], ",", 
        RowBox[{"i", "\[LessEqual]", 
         RowBox[{"Length", "[", "li", "]"}]}], ",", 
        RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"k", "=", 
          RowBox[{
           RowBox[{
            RowBox[{"li", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "[", 
            RowBox[{"[", 
             RowBox[{"1", ";;", ";;", "2"}], "]"}], "]"}], "-", "2"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"x", "=", 
          RowBox[{
           SuperscriptBox["2", 
            RowBox[{"-", "k"}]], 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"2", 
              RowBox[{
               RowBox[{"li", "[", 
                RowBox[{"[", "i", "]"}], "]"}], "[", 
               RowBox[{"[", 
                RowBox[{"2", ";;", ";;", "2"}], "]"}], "]"}]}], "-", "1"}], 
            ")"}]}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"diff", "=", 
          RowBox[{"getCoefficient", "[", 
           RowBox[{"f", ",", "x", ",", "k"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"hash", "\[LeftDoubleBracket]", 
           RowBox[{"count", "++"}], "\[RightDoubleBracket]"}], "=", 
          RowBox[{
           RowBox[{"li", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "\[Rule]", " ", "diff"}]}], 
         ";"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", 
       RowBox[{"SparseArray", "[", "hash", "]"}], "]"}], ";"}]}], 
    "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"This", " ", "is", " ", "working"}], "*)"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"fullReconstruct", "[", 
    RowBox[{"coeffs_", ",", "x_", ",", "l_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "a", ",", "k", ",", "value", ",", "i", ",", "d", ",", "indices", ",", 
       "ki"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"value", "=", "0"}], ";", "\[IndentingNewLine]", 
      RowBox[{"d", "=", 
       RowBox[{"Length", "[", "x", "]"}]}], ";", " ", "\[IndentingNewLine]", 
      RowBox[{"indices", "=", 
       RowBox[{"pointIndex", "[", 
        RowBox[{"x", ",", "l"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"Do", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"ki", "=", 
            RowBox[{"Flatten", "[", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{
                  RowBox[{"k", "[", "a", "]"}], "+", "2"}], ",", 
                 RowBox[{"indices", "\[LeftDoubleBracket]", 
                  RowBox[{"a", ",", 
                   RowBox[{
                    RowBox[{"k", "[", "a", "]"}], "+", "2"}]}], 
                  "\[RightDoubleBracket]"}]}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"a", ",", "1", ",", "d"}], "}"}]}], "]"}], "]"}]}], 
           ";", "\[IndentingNewLine]", 
           RowBox[{"value", "+=", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{
                "coeffs", "\[LeftDoubleBracket]", "##", 
                 "\[RightDoubleBracket]"}], "&"}], "@@", 
               RowBox[{"Sequence", "[", "ki", "]"}]}], ")"}], 
             RowBox[{
              RowBox[{"\[Phi]", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"ki", "\[LeftDoubleBracket]", 
                  RowBox[{"1", ";;", ";;", "2"}], "\[RightDoubleBracket]"}], 
                 "-", "2"}], ",", 
                RowBox[{"ki", "\[LeftDoubleBracket]", 
                 RowBox[{"2", ";;", ";;", "2"}], "\[RightDoubleBracket]"}]}], 
               "]"}], "[", "x", "]"}]}]}], ";"}], "\[IndentingNewLine]", ",", 
          "##"}], "]"}], "&"}], "\[IndentingNewLine]", "@@", 
       RowBox[{"Sequence", "[", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"k", "[", "i", "]"}], ",", 
            RowBox[{"-", "1"}], ",", 
            RowBox[{
            "l", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}]}], 
           "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", "d"}], "}"}]}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "value", "]"}], ";"}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"This", " ", "is", " ", "working"}], ",", 
    RowBox[{
    "but", " ", "you", " ", "can", " ", "make", " ", "it", " ", "slightly", 
     " ", "more", " ", "efficient", " ", "by"}]}], "*)"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"fullReconstruct", "[", 
     RowBox[{"li_", ",", "x_"}], "]"}], ":=", 
    RowBox[{
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"a", ",", "k", ",", "value", ",", "i"}], "}"}], ",", 
       RowBox[{
        RowBox[{"value", "=", "0"}], ";", "\[IndentingNewLine]", 
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"a", "=", "1"}], ",", 
          RowBox[{"a", "\[LessEqual]", " ", 
           RowBox[{"Length", "[", "li", "]"}]}], ",", 
          RowBox[{"a", "++"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"k", "=", 
            RowBox[{
             RowBox[{"Keys", "[", 
              RowBox[{"li", "[", 
               RowBox[{"[", "a", "]"}], "]"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{"1", ";;", ";;", "2"}], "]"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"i", "=", 
            RowBox[{
             RowBox[{"Keys", "[", 
              RowBox[{"li", "[", 
               RowBox[{"[", "a", "]"}], "]"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{"2", ";;", ";;", "2"}], "]"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"atPosition", "[", 
              RowBox[{"x", ",", 
               RowBox[{"k", "-", "2"}], ",", 
               RowBox[{
                RowBox[{"1", "/", "2"}], " ", 
                RowBox[{"(", 
                 RowBox[{"i", "+", "1"}], ")"}]}]}], "]"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"value", "+=", 
              RowBox[{
               RowBox[{"Values", "[", 
                RowBox[{"li", "[", 
                 RowBox[{"[", "a", "]"}], "]"}], "]"}], " ", 
               RowBox[{
                RowBox[{"\[Phi]", "[", 
                 RowBox[{
                  RowBox[{"k", "-", "2"}], ",", 
                  RowBox[{
                   RowBox[{"1", "/", "2"}], " ", 
                   RowBox[{"(", 
                    RowBox[{"i", "+", "1"}], ")"}]}]}], "]"}], "[", "x", 
                "]"}]}]}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}], ";", 
        RowBox[{"Return", "[", "value", "]"}], ";"}]}], "]"}], 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"This", " ", "is", " ", "working"}], ",", " ", 
       RowBox[{
       "but", " ", "you", " ", "can", " ", "make", " ", "it", " ", "much", 
        " ", "more", " ", "effici"}]}], "*)"}], "ent"}]}], "*)"}]}]}], "Input",\

 CellChangeTimes->{{3.6748182341893253`*^9, 3.674818249852869*^9}, {
   3.674818633204528*^9, 3.674818861389419*^9}, {3.674818946825584*^9, 
   3.674818952627338*^9}, {3.674819038829138*^9, 3.674819048143593*^9}, {
   3.674819109888535*^9, 3.674819169906653*^9}, 3.674819243175981*^9, {
   3.674819295879533*^9, 3.674819317561034*^9}, {3.6748194255312033`*^9, 
   3.6748194368152723`*^9}, {3.6748194838674107`*^9, 3.674819564048064*^9}, {
   3.6748196911645737`*^9, 3.674819692687612*^9}, {3.674820101484674*^9, 
   3.6748201029976463`*^9}, {3.674820148583015*^9, 3.674820150594861*^9}, {
   3.6748208169463243`*^9, 3.6748208997236843`*^9}, {3.674821022034358*^9, 
   3.674821080637211*^9}, {3.674821137518283*^9, 3.6748211388582497`*^9}, {
   3.674821196389823*^9, 3.674821201649328*^9}, {3.674821366430667*^9, 
   3.674821456567713*^9}, {3.674821624824584*^9, 3.674821644511746*^9}, {
   3.674821685203264*^9, 3.674821714794752*^9}, {3.6748217564497843`*^9, 
   3.674821826675729*^9}, {3.674821932908564*^9, 3.674822034126877*^9}, {
   3.6748220789412107`*^9, 3.6748220840198717`*^9}, {3.674822630954001*^9, 
   3.674822634643093*^9}, {3.674822932515253*^9, 3.674822932652151*^9}, {
   3.674823077287694*^9, 3.674823216498983*^9}, {3.674823298850649*^9, 
   3.6748232994056883`*^9}, {3.674823339260364*^9, 3.674823364581196*^9}, {
   3.674823404789608*^9, 3.674823413848963*^9}, {3.674823449071734*^9, 
   3.6748236265007*^9}, {3.67482371098314*^9, 3.6748237118565283`*^9}, {
   3.674823763268496*^9, 3.67482376716531*^9}, {3.674823843345739*^9, 
   3.674823886022915*^9}, {3.674823934640646*^9, 3.6748239469093122`*^9}, {
   3.674824200141934*^9, 3.6748242238332767`*^9}, {3.674824369331514*^9, 
   3.674824378805108*^9}, {3.674824454757566*^9, 3.674824484695538*^9}, {
   3.674825226330378*^9, 3.6748252362126513`*^9}, {3.674830952162759*^9, 
   3.674831034187213*^9}, {3.674831085079728*^9, 3.6748311210779467`*^9}, {
   3.674831198480649*^9, 3.67483123732185*^9}, {3.674831299933073*^9, 
   3.6748313491645403`*^9}, {3.674831938598998*^9, 3.6748319456949472`*^9}, {
   3.674832095877576*^9, 3.674832097303121*^9}, {3.6748326315843277`*^9, 
   3.674832647646493*^9}, {3.674832769233962*^9, 3.6748328097540283`*^9}, {
   3.6748328465898542`*^9, 3.674832873942602*^9}, {3.674832951175571*^9, 
   3.6748330555919857`*^9}, {3.674833193413547*^9, 3.674833193492144*^9}, {
   3.6748333511413527`*^9, 3.674833355673777*^9}, 3.674833494153089*^9, {
   3.67483361607542*^9, 3.6748336226080513`*^9}, {3.674833708885251*^9, 
   3.6748337231288*^9}, 3.6748406359458733`*^9, {3.674840712400107*^9, 
   3.674840724084639*^9}, {3.6748407742058077`*^9, 3.6748408014782248`*^9}, {
   3.6748409217584763`*^9, 3.674840922436957*^9}, {3.674840964236013*^9, 
   3.674840965716482*^9}, {3.6748411283748426`*^9, 3.674841135827072*^9}, {
   3.674841166176936*^9, 3.674841183168475*^9}, {3.674841600621426*^9, 
   3.674841602839985*^9}, {3.67484350034758*^9, 3.674843525864192*^9}, {
   3.674910728901267*^9, 3.67491076968318*^9}, {3.675121152882429*^9, 
   3.675121241270269*^9}, {3.6751217712834578`*^9, 3.6751217828951263`*^9}, {
   3.6751218245475407`*^9, 3.6751218730910387`*^9}, {3.67512191066807*^9, 
   3.675122031430805*^9}, {3.6751220843144073`*^9, 3.6751221127082243`*^9}, {
   3.675122214804365*^9, 3.675122226322106*^9}, {3.6751223249707937`*^9, 
   3.675122329734909*^9}, {3.6751223977189217`*^9, 3.675122475288024*^9}, {
   3.675122531869464*^9, 3.6751225664634447`*^9}, {3.675122642264216*^9, 
   3.675122665076829*^9}, {3.675122698527116*^9, 3.675122741582217*^9}, {
   3.675125530385446*^9, 3.675125541887339*^9}, {3.675133843648423*^9, 
   3.675133844269601*^9}, {3.675165732273498*^9, 3.6751657556022587`*^9}, {
   3.67516580307522*^9, 3.675165811960607*^9}, {3.675165850784886*^9, 
   3.675165851168841*^9}, 3.675165935367072*^9, {3.675165968904393*^9, 
   3.675166014693656*^9}, {3.675292427537735*^9, 3.675292432130433*^9}, {
   3.6752924825676937`*^9, 3.675292494335091*^9}, {3.675292542153948*^9, 
   3.675292543983315*^9}, {3.6752927221215353`*^9, 3.6752927226980867`*^9}, {
   3.675292779863377*^9, 3.675292879943811*^9}, {3.675293033596765*^9, 
   3.675293130154948*^9}, {3.67529317720809*^9, 3.675293186204968*^9}, {
   3.6752932970363197`*^9, 3.675293297194639*^9}, {3.675351529065*^9, 
   3.675351603437442*^9}, {3.675351748307798*^9, 3.675351763975153*^9}, {
   3.6753518371060143`*^9, 3.6753518662225227`*^9}, 3.675356318843627*^9, 
   3.675359517869048*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Sparse Iteration in n-D", "Subsection",
 CellChangeTimes->{{3.673277052290266*^9, 3.673277056255988*^9}, {
  3.67357648054101*^9, 3.673576481088376*^9}, {3.674843506874929*^9, 
  3.674843513409747*^9}, {3.674911022015613*^9, 3.674911022957762*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"sparseIterate", "[", 
    RowBox[{"n_", ",", "d_", ",", "ki_List"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"k", ",", "i", ",", "hashEntry", ",", "hashMap", ",", "count"}],
       "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"hashMap", "=", 
       RowBox[{"Table", "[", 
        RowBox[{"0", ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "0", ",", 
           SuperscriptBox["2", "n"]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"count", "=", "1"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"d", "\[Equal]", "1"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"For", "[", 
          RowBox[{
           RowBox[{"k", "=", 
            RowBox[{"-", "1"}]}], ",", 
           RowBox[{"k", "\[LessEqual]", "n"}], ",", 
           RowBox[{"k", "++"}], ",", "\[IndentingNewLine]", 
           RowBox[{"For", "[", 
            RowBox[{
             RowBox[{"i", "=", "1"}], ",", 
             RowBox[{"i", "\[LessEqual]", 
              SuperscriptBox["2", 
               RowBox[{
                RowBox[{"switch", "[", "k", "]"}], "-", "1"}]]}], ",", 
             RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"hashEntry", "=", 
               RowBox[{"Append", "[", 
                RowBox[{
                 RowBox[{"Append", "[", 
                  RowBox[{"ki", ",", 
                   RowBox[{"k", "+", "2"}]}], "]"}], ",", "i"}], "]"}]}], ";",
               "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"hashMap", "\[LeftDoubleBracket]", 
                RowBox[{"count", "++"}], "\[RightDoubleBracket]"}], "=", 
               "hashEntry"}], ";"}]}], "\[IndentingNewLine]", "]"}]}], "]"}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"Return", "[", "hashMap", "]"}], ";"}], 
        "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"For", "[", 
          RowBox[{
           RowBox[{"k", "=", 
            RowBox[{"-", "1"}]}], ",", 
           RowBox[{"k", "\[LessEqual]", "n"}], ",", 
           RowBox[{"k", "++"}], ",", "\[IndentingNewLine]", 
           RowBox[{"For", "[", 
            RowBox[{
             RowBox[{"i", "=", "1"}], ",", 
             RowBox[{"i", "\[LessEqual]", 
              SuperscriptBox["2", 
               RowBox[{
                RowBox[{"switch", "[", "k", "]"}], "-", "1"}]]}], ",", 
             RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"hashEntry", "=", 
               RowBox[{"sparseIterate", "[", 
                RowBox[{
                 RowBox[{"n", "-", "k", "-", "1"}], ",", 
                 RowBox[{"d", "-", "1"}], ",", 
                 RowBox[{"Append", "[", 
                  RowBox[{
                   RowBox[{"Append", "[", 
                    RowBox[{"ki", ",", 
                    RowBox[{"k", "+", "2"}]}], "]"}], ",", "i"}], "]"}]}], 
                "]"}]}], ";", 
              RowBox[{
               RowBox[{"hashMap", "\[LeftDoubleBracket]", 
                RowBox[{"count", "++"}], "\[RightDoubleBracket]"}], "=", 
               "hashEntry"}], ";"}]}], "]"}]}], "]"}], ";", 
         RowBox[{"Return", "[", "hashMap", "]"}]}], ",", 
        RowBox[{"2", "d"}]}], 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
          RowBox[{"All", " ", "the", " ", "work", " ", "with", " ", 
           RowBox[{"Flatten", "/", "Partition"}], " ", "is", " ", "like"}], 
          ".."}], " ", "no", " ", "cost"}], "*)"}], "\[IndentingNewLine]", 
       "]"}]}]}], "]"}]}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"This", " ", "is", " ", "working"}], "*)"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"sparseIterate", "[", 
    RowBox[{"n_", ",", "d_"}], "]"}], ":=", 
   RowBox[{"Partition", "[", 
    RowBox[{
     RowBox[{"Flatten", "[", 
      RowBox[{"sparseIterate", "[", 
       RowBox[{"n", ",", "d", ",", 
        RowBox[{"{", "}"}]}], "]"}], "]"}], ",", 
     RowBox[{"2", "d"}]}], "]"}]}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"This", " ", "is", " ", "working"}], "*)"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"sparsekIterate", "[", 
    RowBox[{"n_", ",", "d_", ",", "l_List"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"k", ",", "hashEntry", ",", "hashMap", ",", "count"}], "}"}], 
     ",", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"d", "\[Equal]", "1"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"count", "=", "1"}], ";", "\[IndentingNewLine]", 
        RowBox[{"hashMap", "=", 
         RowBox[{"Table", "[", 
          RowBox[{"0", ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"n", "+", "2"}]}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"k", "=", 
           RowBox[{"-", "1"}]}], ",", 
          RowBox[{"k", "\[LessEqual]", "n"}], ",", 
          RowBox[{"k", "++"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"hashEntry", "=", 
            RowBox[{"Append", "[", 
             RowBox[{"l", ",", 
              RowBox[{"k", "+", "2"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
           
           RowBox[{
            RowBox[{"hashMap", "\[LeftDoubleBracket]", 
             RowBox[{"count", "++"}], "\[RightDoubleBracket]"}], "=", 
            "hashEntry"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
        RowBox[{"Return", "[", "hashMap", "]"}]}], "\[IndentingNewLine]", ",",
        "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"count", "=", "1"}], ";", "\[IndentingNewLine]", 
        RowBox[{"hashMap", "=", 
         RowBox[{"Table", "[", 
          RowBox[{"0", ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"(", 
              RowBox[{"n", "+", "2"}], ")"}]}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"k", "=", 
           RowBox[{"-", "1"}]}], ",", 
          RowBox[{"k", "\[LessEqual]", "n"}], ",", 
          RowBox[{"k", "++"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"hashEntry", "=", 
            RowBox[{"sparsekIterate", "[", 
             RowBox[{
              RowBox[{"n", "-", "k", "-", "1"}], ",", 
              RowBox[{"d", "-", "1"}], ",", 
              RowBox[{"Append", "[", 
               RowBox[{"l", ",", 
                RowBox[{"k", "+", "2"}]}], "]"}]}], "]"}]}], ";", 
           RowBox[{
            RowBox[{"hashMap", "\[LeftDoubleBracket]", 
             RowBox[{"count", "++"}], "\[RightDoubleBracket]"}], "=", 
            "hashEntry"}], ";"}]}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"Return", "[", "hashMap", "]"}]}]}], "\[IndentingNewLine]", 
      "]"}]}], "]"}]}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"sparsekIterate", "[", 
   RowBox[{"n_", ",", "d_"}], "]"}], ":=", 
  RowBox[{"Partition", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"sparsekIterate", "[", 
      RowBox[{"n", ",", "d", ",", 
       RowBox[{"{", "}"}]}], "]"}], "//", "Flatten"}], ",", "d"}], 
   "]"}]}]}], "Input",
 CellChangeTimes->{{3.674911026079825*^9, 3.674911026525655*^9}, {
   3.674911340076722*^9, 3.674911423318684*^9}, {3.674911506830521*^9, 
   3.674911521081118*^9}, {3.674911952264309*^9, 3.6749119569255457`*^9}, {
   3.674912300624488*^9, 3.6749123026436167`*^9}, {3.674912499434155*^9, 
   3.674912519522588*^9}, {3.6749125568469048`*^9, 3.674912596130492*^9}, {
   3.674916236863957*^9, 3.674916236879312*^9}, {3.67491636727288*^9, 
   3.674916369500132*^9}, {3.675125664533416*^9, 3.6751256660930557`*^9}, 
   3.675125749092605*^9, {3.6752851607073917`*^9, 3.675285169644924*^9}, {
   3.6752853051812277`*^9, 3.6752853099023848`*^9}, {3.675286554334086*^9, 
   3.675286567404766*^9}, {3.675286646086626*^9, 3.675286700775078*^9}, {
   3.675286734212901*^9, 3.675286737255945*^9}, {3.675289888245862*^9, 
   3.675289910743932*^9}, {3.675289943897991*^9, 3.675289990347809*^9}, {
   3.675290054527487*^9, 3.675290089297982*^9}, {3.6752907855613737`*^9, 
   3.675290798954557*^9}, {3.675290864962373*^9, 3.675290888345681*^9}, {
   3.675350844320705*^9, 3.675350907538185*^9}, {3.675351925979435*^9, 
   3.675352142526486*^9}, 3.675352197371854*^9, {3.675352234599778*^9, 
   3.675352242796063*^9}, {3.6753523568554153`*^9, 3.6753523739064093`*^9}, {
   3.675352520975141*^9, 3.675352530645988*^9}, {3.675352764914473*^9, 
   3.6753527695418653`*^9}, {3.675352832584362*^9, 3.675352833220649*^9}, {
   3.675352882910246*^9, 3.675352884638152*^9}, {3.6753530559737*^9, 
   3.675353075478669*^9}, {3.675353264954591*^9, 3.675353284378565*^9}, {
   3.675353339010449*^9, 3.67535334296525*^9}, {3.675353449052278*^9, 
   3.675353463491477*^9}, {3.675353586274519*^9, 3.67535358645875*^9}, {
   3.675353625984117*^9, 3.675353656740477*^9}, {3.6753537957105207`*^9, 
   3.675353800175552*^9}, {3.6753538394262238`*^9, 3.675353897375038*^9}, {
   3.6753540009994383`*^9, 3.675354006780195*^9}, {3.675354054993297*^9, 
   3.675354061517929*^9}, {3.675354105275877*^9, 3.675354114186668*^9}, {
   3.6753553227887993`*^9, 3.675355326810321*^9}, 3.675360540702847*^9, {
   3.6757253292713842`*^9, 3.675725362959104*^9}, 3.675725404715789*^9, 
   3.675725437366311*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Sparse Basis", "Subsection",
 CellChangeTimes->{{3.673277052290266*^9, 3.673277061302971*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"sparseCoefficients", "[", 
    RowBox[{"f_", ",", "n_", ",", "d_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "li", ",", "hash", ",", "k", ",", "i", ",", "diff", ",", "x", ",", 
       "count"}], "}"}], ",", 
     RowBox[{
      RowBox[{"li", "=", 
       RowBox[{"sparseIterate", "[", 
        RowBox[{"n", ",", "d"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"hash", "=", 
       RowBox[{"Table", "[", 
        RowBox[{"0", ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", 
           RowBox[{"Length", "[", "li", "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"count", "=", "1"}], ";", "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"i", "=", "1"}], ",", 
        RowBox[{"i", "\[LessEqual]", 
         RowBox[{"Length", "[", "li", "]"}]}], ",", 
        RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"k", "=", 
          RowBox[{
           RowBox[{
            RowBox[{"li", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "[", 
            RowBox[{"[", 
             RowBox[{"1", ";;", ";;", "2"}], "]"}], "]"}], "-", "2"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"x", "=", 
          RowBox[{
           SuperscriptBox["2", 
            RowBox[{"-", "k"}]], 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"2", 
              RowBox[{
               RowBox[{"li", "[", 
                RowBox[{"[", "i", "]"}], "]"}], "[", 
               RowBox[{"[", 
                RowBox[{"2", ";;", ";;", "2"}], "]"}], "]"}]}], "-", "1"}], 
            ")"}]}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"diff", "=", 
          RowBox[{"getCoefficient", "[", 
           RowBox[{"f", ",", "x", ",", "k"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"hash", "\[LeftDoubleBracket]", 
           RowBox[{"count", "++"}], "\[RightDoubleBracket]"}], "=", 
          RowBox[{
           RowBox[{"li", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "\[Rule]", " ", "diff"}]}], 
         ";"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", 
       RowBox[{"SparseArray", "[", "hash", "]"}], "]"}], ";"}]}], 
    "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"Working", " ", "efficiently"}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"sparseReconstruct", "[", 
    RowBox[{"coefficients_", ",", "x_", ",", "n_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "a", ",", "k", ",", "value", ",", "i", ",", "d", ",", "indices", ",", 
       "ki", ",", "iters"}], "}"}], ",", 
     RowBox[{
      RowBox[{"value", "=", "0"}], ";", 
      RowBox[{"d", "=", 
       RowBox[{"Length", "[", "x", "]"}]}], ";", " ", 
      RowBox[{"indices", "=", 
       RowBox[{"spointIndex", "[", 
        RowBox[{"x", ",", "n"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"iters", "=", 
       RowBox[{"sparsekIterate", "[", 
        RowBox[{"n", ",", "d"}], "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"i", "=", "1"}], ",", 
        RowBox[{"i", "\[LessEqual]", 
         RowBox[{"Length", "[", "iters", "]"}]}], ",", 
        RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"ki", "=", 
          RowBox[{"Flatten", "[", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                 "iters", "\[LeftDoubleBracket]", "i", 
                  "\[RightDoubleBracket]"}], ")"}], "\[LeftDoubleBracket]", 
                "a", "\[RightDoubleBracket]"}], ",", 
               RowBox[{"indices", "\[LeftDoubleBracket]", 
                RowBox[{"a", ",", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                   "iters", "\[LeftDoubleBracket]", "i", 
                    "\[RightDoubleBracket]"}], ")"}], "\[LeftDoubleBracket]", 
                  "a", "\[RightDoubleBracket]"}]}], 
                "\[RightDoubleBracket]"}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"a", ",", "1", ",", "d"}], "}"}]}], "]"}], "]"}]}], ";",
          "\[IndentingNewLine]", 
         RowBox[{"value", "+=", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{
              "coefficients", "\[LeftDoubleBracket]", "##", 
               "\[RightDoubleBracket]"}], "&"}], "@@", 
             RowBox[{"Sequence", "[", "ki", "]"}]}], ")"}], 
           RowBox[{
            RowBox[{"\[Phi]", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"ki", "\[LeftDoubleBracket]", 
                RowBox[{"1", ";;", ";;", "2"}], "\[RightDoubleBracket]"}], 
               "-", "2"}], ",", 
              RowBox[{"ki", "\[LeftDoubleBracket]", 
               RowBox[{"2", ";;", ";;", "2"}], "\[RightDoubleBracket]"}]}], 
             "]"}], "[", "x", "]"}]}]}], ";"}]}], "\[IndentingNewLine]", 
       "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "value", "]"}], ";"}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"Finally", " ", "Working"}], "*)"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"sparseReconstruct", "[", 
    RowBox[{"coefficients_", ",", "x_"}], "]"}], ":=", 
   RowBox[{"fullReconstruct", "[", 
    RowBox[{"coefficients", ",", "x"}], "]"}]}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"Finally", " ", "Working"}], "*)"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"reverseFlattenSparse", "[", 
   RowBox[{"coefficients_", ",", "n_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "k", "}"}], ",", 
    RowBox[{
     RowBox[{"k", "=", "0"}], ";", 
     RowBox[{"Return", "[", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"coefficients", "\[LeftDoubleBracket]", 
             RowBox[{"++", "k"}], "\[RightDoubleBracket]"}], " ", ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "1", ",", 
              RowBox[{
               SuperscriptBox["2", 
                RowBox[{"switch", "[", 
                 RowBox[{"getrow", "[", 
                  RowBox[{"perp", ",", "diag"}], "]"}], "]"}]], "-", "1"}], 
              ",", "2"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"j", ",", "1", ",", 
              RowBox[{
               SuperscriptBox["2", 
                RowBox[{"switch", "[", 
                 RowBox[{"getcol", "[", 
                  RowBox[{"perp", ",", "diag"}], "]"}], "]"}]], "-", "1"}], 
              ",", "2"}], "}"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"perp", ",", 
            RowBox[{"-", "1"}], ",", 
            RowBox[{"endperp", "[", "diag", "]"}]}], "}"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"diag", ",", 
          RowBox[{"-", "1"}], ",", "n"}], "}"}]}], "]"}], "]"}], ";"}]}], 
   "]"}]}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.672618929348575*^9, 3.6726189300061407`*^9}, {
   3.672618978737381*^9, 3.672619078806769*^9}, {3.672619110725196*^9, 
   3.672619157350065*^9}, {3.672619193438739*^9, 3.67261920365707*^9}, {
   3.672619319494294*^9, 3.672619334232011*^9}, {3.67262008873687*^9, 
   3.672620094647687*^9}, {3.67262015651656*^9, 3.672620440911069*^9}, {
   3.6726205701211433`*^9, 3.67262063754361*^9}, {3.672676267266491*^9, 
   3.672676273622691*^9}, {3.6726763961071568`*^9, 3.672676404788162*^9}, {
   3.6732665910954447`*^9, 3.673266619018859*^9}, {3.673266658674885*^9, 
   3.673266663847871*^9}, {3.673269162063302*^9, 3.673269227835155*^9}, {
   3.6732692710491867`*^9, 3.673269277740987*^9}, {3.673269310322139*^9, 
   3.6732693403785973`*^9}, {3.673277030707767*^9, 3.673277034000938*^9}, {
   3.673627599666712*^9, 3.673627625079471*^9}, {3.673627832142569*^9, 
   3.6736279276961527`*^9}, {3.6736279872590714`*^9, 3.673627987495245*^9}, {
   3.673628028968935*^9, 3.673628098048843*^9}, {3.673628424293537*^9, 
   3.673628424484264*^9}, {3.673628628463648*^9, 3.673628628574724*^9}, {
   3.6736287722368917`*^9, 3.673628812901684*^9}, {3.673628856743156*^9, 
   3.673628899406356*^9}, {3.6736294759345503`*^9, 3.673629483468844*^9}, 
   3.6736295186229763`*^9, {3.673630334859116*^9, 3.6736304022984457`*^9}, {
   3.673630813940319*^9, 3.673630816180293*^9}, 3.67370039301103*^9, {
   3.673782946285776*^9, 3.673782964305489*^9}, {3.6737829947533092`*^9, 
   3.6737830274457273`*^9}, {3.673783160702259*^9, 3.673783172602543*^9}, {
   3.67378326572011*^9, 3.673783308866743*^9}, {3.673783340462134*^9, 
   3.673783419519454*^9}, {3.673784243401146*^9, 3.6737842639124947`*^9}, {
   3.67378452670199*^9, 3.673784566047907*^9}, {3.6737846210423727`*^9, 
   3.67378464273494*^9}, {3.673784738036634*^9, 3.67378476262145*^9}, {
   3.673785866920824*^9, 3.673785886606626*^9}, {3.673786447224745*^9, 
   3.673786477162902*^9}, {3.6737875807216*^9, 3.67378764476019*^9}, {
   3.673787718978281*^9, 3.673787763520397*^9}, {3.673788178123294*^9, 
   3.67378822384226*^9}, {3.6737987403772593`*^9, 3.6737987463428993`*^9}, {
   3.673798833989471*^9, 3.673798854517301*^9}, {3.67379902265583*^9, 
   3.673799153787937*^9}, {3.6738031149029207`*^9, 3.673803117513816*^9}, {
   3.6738032301133327`*^9, 3.67380323901864*^9}, {3.67380351441521*^9, 
   3.6738036175419273`*^9}, {3.673804153635599*^9, 3.673804241715304*^9}, {
   3.6738042961849813`*^9, 3.673804296724662*^9}, {3.673873396311283*^9, 
   3.673873397564124*^9}, {3.673873430072906*^9, 3.673873433691896*^9}, {
   3.673917687909233*^9, 3.673917688455737*^9}, {3.674392109558003*^9, 
   3.67439214927945*^9}, {3.674834356865294*^9, 3.67483442684452*^9}, {
   3.674834458210053*^9, 3.674834482865242*^9}, {3.674912613641386*^9, 
   3.6749127592940893`*^9}, {3.674912792065713*^9, 3.674912883717437*^9}, 
   3.674915849295414*^9, {3.674917398327202*^9, 3.674917405917941*^9}, {
   3.675125764926906*^9, 3.675125830651813*^9}, {3.675290978566462*^9, 
   3.6752909862231417`*^9}, {3.675347587766035*^9, 3.675347617489012*^9}, {
   3.675347662907089*^9, 3.6753476899257803`*^9}, {3.675350822452766*^9, 
   3.675350830708499*^9}, 3.6753509756009483`*^9, {3.6753542528574247`*^9, 
   3.675354253285595*^9}, {3.6753545950933657`*^9, 3.675354716320117*^9}, {
   3.675354873524189*^9, 3.675354895680046*^9}, {3.675355066408283*^9, 
   3.675355078040924*^9}, 3.6753551827835407`*^9, {3.675360100861123*^9, 
   3.67536010846562*^9}, {3.6753601502235527`*^9, 3.675360185947586*^9}, {
   3.6753602239800167`*^9, 3.675360314434198*^9}, {3.675360819938837*^9, 
   3.675360828847631*^9}, {3.6753608910822153`*^9, 3.67536091416614*^9}, {
   3.675361073238727*^9, 3.675361084167658*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Differentiation", "Subsection",
 CellChangeTimes->{{3.673277052290266*^9, 3.673277061302971*^9}, {
  3.673277119209675*^9, 3.6732771212386723`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"diffx", "[", 
    RowBox[{"f_", ",", "l_Integer", ",", "x_List"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"ans", ",", "temp"}], "}"}], ",", 
     RowBox[{
      RowBox[{"temp", "=", "x"}], ";", 
      RowBox[{"Which", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"x", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
         "<", " ", 
         SuperscriptBox["2", 
          RowBox[{"-", "l"}]]}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{
          "temp", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], "+=", 
          SuperscriptBox["2", 
           RowBox[{"-", "l"}]]}], ";", " ", 
         RowBox[{"ans", "=", 
          RowBox[{
           RowBox[{"f", "[", "temp", "]"}], "-", 
           RowBox[{"f", "[", "x", "]"}]}]}], ";", " ", 
         RowBox[{"ans", "*=", 
          SuperscriptBox["2", "l"]}], ";"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"x", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
         ">", 
         RowBox[{"1", "-", 
          SuperscriptBox["2", 
           RowBox[{"-", "l"}]]}]}], " ", ",", 
        RowBox[{
         RowBox[{
          RowBox[{
          "temp", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], "-=", 
          SuperscriptBox["2", 
           RowBox[{"-", "l"}]]}], ";", " ", 
         RowBox[{"ans", "=", 
          RowBox[{
           RowBox[{"f", "[", "x", "]"}], "-", 
           RowBox[{"f", "[", "temp", "]"}]}]}], ";", " ", 
         RowBox[{"ans", "*=", 
          SuperscriptBox["2", "l"]}], ";"}], ",", "\[IndentingNewLine]", 
        "True", ",", 
        RowBox[{
         RowBox[{
          RowBox[{
          "temp", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], "+=", 
          SuperscriptBox["2", 
           RowBox[{"-", "l"}]]}], ";", 
         RowBox[{"ans", "=", 
          RowBox[{"f", "[", "temp", "]"}]}], ";", 
         RowBox[{
          RowBox[{
          "temp", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], "-=", 
          RowBox[{"2", " ", 
           SuperscriptBox["2", 
            RowBox[{"-", "l"}]]}]}], ";", " ", 
         RowBox[{"ans", "-=", 
          RowBox[{"f", "[", "temp", "]"}]}], ";", 
         RowBox[{"ans", "*=", 
          RowBox[{"(", 
           SuperscriptBox["2", 
            RowBox[{"l", "-", "1"}]], ")"}]}], ";"}]}], "]"}], ";", 
      RowBox[{"Return", "[", "ans", "]"}], ";"}]}], "]"}]}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{"This", " ", "is", " ", "working"}], ".."}], " ", "I", " ", 
    "think", " ", 
    RowBox[{"it", "'"}], "s", " ", 
    RowBox[{"efficient", ".", " ", "We"}], " ", "could", " ", "do", " ", "a", 
    " ", "general", " ", 
    RowBox[{"one", ":"}]}], " ", "*)"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"diff", "[", 
    RowBox[{"f_", ",", "l_Integer", ",", "x_List", ",", 
     RowBox[{"i_:", "1"}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"ans", ",", "temp"}], "}"}], ",", 
     RowBox[{
      RowBox[{"temp", "=", "x"}], ";", 
      RowBox[{"Which", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"x", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
         "<", " ", 
         SuperscriptBox["2", 
          RowBox[{"-", "l"}]]}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{
          "temp", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], "+=", 
          SuperscriptBox["2", 
           RowBox[{"-", "l"}]]}], ";", " ", 
         RowBox[{"ans", "=", 
          RowBox[{
           RowBox[{"f", "[", "temp", "]"}], "-", 
           RowBox[{"f", "[", "x", "]"}]}]}], ";", " ", 
         RowBox[{"ans", "*=", 
          SuperscriptBox["2", "l"]}], ";"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"x", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
         ">", 
         RowBox[{"1", "-", 
          SuperscriptBox["2", 
           RowBox[{"-", "l"}]]}]}], " ", ",", 
        RowBox[{
         RowBox[{
          RowBox[{
          "temp", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], "-=", 
          SuperscriptBox["2", 
           RowBox[{"-", "l"}]]}], ";", " ", 
         RowBox[{"ans", "=", 
          RowBox[{
           RowBox[{"f", "[", "x", "]"}], "-", 
           RowBox[{"f", "[", "temp", "]"}]}]}], ";", " ", 
         RowBox[{"ans", "*=", 
          SuperscriptBox["2", "l"]}], ";"}], ",", "\[IndentingNewLine]", 
        "True", ",", 
        RowBox[{
         RowBox[{
          RowBox[{
          "temp", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], "+=", 
          SuperscriptBox["2", 
           RowBox[{"-", "l"}]]}], ";", 
         RowBox[{"ans", "=", 
          RowBox[{"f", "[", "temp", "]"}]}], ";", 
         RowBox[{
          RowBox[{
          "temp", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], "-=", 
          RowBox[{"2", " ", 
           SuperscriptBox["2", 
            RowBox[{"-", "l"}]]}]}], ";", " ", 
         RowBox[{"ans", "-=", 
          RowBox[{"f", "[", "temp", "]"}]}], ";", 
         RowBox[{"ans", "*=", 
          RowBox[{"(", 
           SuperscriptBox["2", 
            RowBox[{"l", "-", "1"}]], ")"}]}], ";"}]}], "]"}], ";", 
      RowBox[{"Return", "[", "ans", "]"}], ";"}]}], "]"}]}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"And", " ", "just", " ", "in", " ", "case"}], ",", " ", 
    RowBox[{"a", " ", 
     RowBox[{"gradient", ":"}]}]}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"grad", "[", 
   RowBox[{"f_", ",", "l_List", ",", "x_List"}], "]"}], ":=", 
  RowBox[{"Table", "[", 
   RowBox[{
    RowBox[{"diff", "[", 
     RowBox[{"f", ",", 
      RowBox[{"l", "[", 
       RowBox[{"[", "i", "]"}], "]"}], ",", "x", ",", "i"}], "]"}], ",", 
    RowBox[{"{", 
     RowBox[{"i", ",", "1", ",", 
      RowBox[{"Length", "[", "x", "]"}]}], "}"}]}], 
   "]"}]}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.673194722114348*^9, 3.673194848078546*^9}, {
   3.673195420421319*^9, 3.673195424146777*^9}, {3.67319548233215*^9, 
   3.6731954984431143`*^9}, {3.673195695801755*^9, 3.673195698084182*^9}, {
   3.673195740549865*^9, 3.673195742188155*^9}, {3.673195791828994*^9, 
   3.67319579584198*^9}, {3.673195916950042*^9, 3.673195927075912*^9}, {
   3.673272654000877*^9, 3.673272657649295*^9}, {3.673631402814698*^9, 
   3.673631509795334*^9}, {3.673631572843629*^9, 3.6736315790820503`*^9}, {
   3.6736441006268263`*^9, 3.673644104168631*^9}, {3.673885192542933*^9, 
   3.673885195489036*^9}, {3.673885335765209*^9, 3.673885349630846*^9}, {
   3.6738875582237167`*^9, 3.6738875675630074`*^9}, {3.673895232459442*^9, 
   3.673895244343113*^9}, {3.673895342587188*^9, 3.673895390745644*^9}, {
   3.673895441812624*^9, 3.6738954476883183`*^9}, {3.673958458014495*^9, 
   3.673958458202693*^9}, {3.6741811646728992`*^9, 3.6741811784355307`*^9}, {
   3.674183731516361*^9, 3.674183771591733*^9}, {3.674916999869879*^9, 
   3.674917179839369*^9}, {3.674917306426346*^9, 3.674917344936558*^9}, 
   3.6749173767087803`*^9, {3.6749174912651377`*^9, 3.674917599792685*^9}, {
   3.6749288811604033`*^9, 3.674928897349457*^9}, {3.674929100007073*^9, 
   3.674929143353079*^9}, {3.674929181236951*^9, 3.674929374569173*^9}, {
   3.674929550969922*^9, 3.6749296228359833`*^9}, {3.674929986618476*^9, 
   3.674929988000207*^9}, {3.674930040289069*^9, 3.674930120374999*^9}, {
   3.674930156854645*^9, 3.674930159499889*^9}, {3.6749302964124126`*^9, 
   3.674930428333232*^9}, {3.674930461164208*^9, 3.674930461455158*^9}, {
   3.675361221601698*^9, 3.6753612228865128`*^9}}],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{"Past", " ", "this", " ", "point", " ", "idk"}], "..."}], " ", 
  "*)"}]], "Input",
 CellChangeTimes->{{3.6749356608993263`*^9, 3.674935669571991*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Showing the Grids", "Subsection",
 CellChangeTimes->{{3.673277052290266*^9, 3.673277061302971*^9}, {
  3.673277119209675*^9, 3.6732771212386723`*^9}, {3.673348508736053*^9, 
  3.673348513701818*^9}, {3.6737269924034224`*^9, 3.6737269925381393`*^9}, {
  3.6739173803011847`*^9, 3.6739173831779957`*^9}, {3.673976589259214*^9, 
  3.673976594082218*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"makeFull", "[", 
   RowBox[{"lx_", ",", "ly_"}], "]"}], ":=", 
  RowBox[{"Table", "[", 
   RowBox[{
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"switch2", "[", "kx", "]"}], " ", "i"}], ",", 
        RowBox[{
         RowBox[{"switch2", "[", "ky", "]"}], " ", "j"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"i", ",", "1", ",", 
        RowBox[{
         SuperscriptBox["2", 
          RowBox[{"switch", "[", "kx", "]"}]], "-", "1"}], ",", "2"}], "}"}], 
      ",", 
      RowBox[{"{", 
       RowBox[{"j", ",", "1", ",", 
        RowBox[{
         SuperscriptBox["2", 
          RowBox[{"switch", "[", "ky", "]"}]], "-", "1"}], ",", "2"}], 
       "}"}]}], "]"}], ",", 
    RowBox[{"{", 
     RowBox[{"kx", ",", 
      RowBox[{"-", "1"}], ",", "lx"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"ky", ",", 
      RowBox[{"-", "1"}], ",", "ly"}], "}"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.673976295843335*^9, 3.673976324456502*^9}, {
  3.6739764051358023`*^9, 3.673976409670679*^9}, {3.673976443216154*^9, 
  3.67397644959867*^9}, {3.673976570690834*^9, 3.673976571212369*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"makeSparse", "[", "n_", "]"}], ":=", 
  RowBox[{"Table", "[", 
   RowBox[{
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"switch2", "[", 
            RowBox[{"getrow", "[", 
             RowBox[{"perp", ",", "diag"}], "]"}], "]"}], " ", "i"}], ",", 
          RowBox[{
           RowBox[{"switch2", "[", 
            RowBox[{"getcol", "[", 
             RowBox[{"perp", ",", "diag"}], "]"}], "]"}], " ", "j"}]}], "}"}],
         ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "1", ",", 
          RowBox[{
           SuperscriptBox["2", 
            RowBox[{"switch", "[", 
             RowBox[{"getrow", "[", 
              RowBox[{"perp", ",", "diag"}], "]"}], "]"}]], "-", "1"}], ",", 
          "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"j", ",", "1", ",", 
          RowBox[{
           SuperscriptBox["2", 
            RowBox[{"switch", "[", 
             RowBox[{"getcol", "[", 
              RowBox[{"perp", ",", "diag"}], "]"}], "]"}]], "-", "1"}], ",", 
          "2"}], "}"}]}], "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"perp", ",", 
        RowBox[{"-", "1"}], ",", 
        RowBox[{"endperp", "[", "diag", "]"}]}], "}"}]}], "]"}], ",", 
    RowBox[{"{", 
     RowBox[{"diag", ",", 
      RowBox[{"-", "1"}], ",", "n"}], "}"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.673976489827297*^9, 3.673976506875458*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Integration on the Grids", "Subsection",
 CellChangeTimes->{{3.673277052290266*^9, 3.673277061302971*^9}, {
  3.673277119209675*^9, 3.6732771212386723`*^9}, {3.673348508736053*^9, 
  3.673348513701818*^9}, {3.6737269924034224`*^9, 3.6737269925381393`*^9}, {
  3.6739173803011847`*^9, 3.6739173831779957`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"posW", "[", "x_", "]"}], ":=", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{
       RowBox[{"x", "\[Equal]", "0"}], "||", 
       RowBox[{"x", "\[Equal]", "1"}]}], ")"}], ",", 
     RowBox[{"1", "/", "2"}], ",", "1"}], "]"}]}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"fullIntegrate", "[", 
    RowBox[{"f_", ",", "kx_", ",", "ky_"}], "]"}], ":=", 
   RowBox[{"Sum", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"2", "^", 
       RowBox[{"-", "kx"}]}], " ", 
      RowBox[{"2", "^", 
       RowBox[{"-", "ky"}]}], "  ", 
      RowBox[{"posW", "[", "i", "]"}], 
      RowBox[{"posW", "[", "j", "]"}], " ", 
      RowBox[{"f", "[", 
       RowBox[{"i", ",", "j"}], "]"}]}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "0", ",", "1", ",", 
       SuperscriptBox["2", 
        RowBox[{"-", "kx"}]]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"j", ",", "0", ",", "1", ",", 
       SuperscriptBox["2", 
        RowBox[{"-", "ky"}]]}], "}"}]}], "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"fullIntegrate", "[", 
    RowBox[{"f_", ",", "kx_"}], "]"}], ":=", 
   RowBox[{"Sum", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"2", "^", 
       RowBox[{"-", "kx"}]}], "  ", 
      RowBox[{"posW", "[", "i", "]"}], 
      RowBox[{"f", "[", "i", "]"}]}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "0", ",", "1", ",", 
       RowBox[{"2", "^", 
        RowBox[{"-", "kx"}]}]}], "}"}]}], "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"sparseIntegrate", "[", 
    RowBox[{"f_", ",", "n_"}], "]"}], ":=", 
   RowBox[{"Sum", "[", 
    RowBox[{
     RowBox[{"Sum", "[", 
      RowBox[{
       RowBox[{"Sum", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"posW", "[", 
           RowBox[{
            RowBox[{"switch2", "[", 
             RowBox[{"getrow", "[", 
              RowBox[{"perp", ",", "diag"}], "]"}], "]"}], " ", "i"}], "]"}], 
          
          RowBox[{"posW", "[", 
           RowBox[{
            RowBox[{"switch2", "[", 
             RowBox[{"getcol", "[", 
              RowBox[{"perp", ",", "diag"}], "]"}], "]"}], " ", "j"}], "]"}], 
          
          RowBox[{"switch2", "[", 
           RowBox[{"getcol", "[", 
            RowBox[{"perp", ",", "diag"}], "]"}], "]"}], 
          RowBox[{"switch2", "[", "n", "]"}], 
          RowBox[{"f", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"switch2", "[", 
              RowBox[{"getrow", "[", 
               RowBox[{"perp", ",", "diag"}], "]"}], "]"}], " ", "i"}], ",", 
            RowBox[{
             RowBox[{"switch2", "[", 
              RowBox[{"getcol", "[", 
               RowBox[{"perp", ",", "diag"}], "]"}], "]"}], " ", "j"}]}], 
           "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", 
           SuperscriptBox["2", 
            RowBox[{"switch", "[", 
             RowBox[{"getrow", "[", 
              RowBox[{"perp", ",", "diag"}], "]"}], "]"}]], ",", "2"}], "}"}],
          ",", 
         RowBox[{"{", 
          RowBox[{"j", ",", "1", ",", 
           RowBox[{
            SuperscriptBox["2", 
             RowBox[{"switch", "[", 
              RowBox[{"getcol", "[", 
               RowBox[{"perp", ",", "diag"}], "]"}], "]"}]], "-", "1"}], ",", 
           "2"}], "}"}]}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"perp", ",", 
         RowBox[{"-", "1"}], ",", 
         RowBox[{"endperp", "[", "diag", "]"}]}], "}"}]}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"diag", ",", 
       RowBox[{"-", "1"}], ",", "n"}], "}"}]}], "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"sparseIntegrateByCoefficients", "[", 
    RowBox[{"f_", ",", "n_"}], "]"}], ":=", 
   RowBox[{"Sum", "[", 
    RowBox[{
     RowBox[{"Sum", "[", 
      RowBox[{
       RowBox[{"Sum", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"getCoefficient2D", "[", 
           RowBox[{"f", ",", 
            RowBox[{
             RowBox[{"switch2", "[", 
              RowBox[{"getrow", "[", 
               RowBox[{"perp", ",", "diag"}], "]"}], "]"}], " ", "i"}], ",", 
            RowBox[{
             RowBox[{"switch2", "[", 
              RowBox[{"getcol", "[", 
               RowBox[{"perp", ",", "diag"}], "]"}], "]"}], " ", "j"}], ",", 
            RowBox[{"getrow", "[", 
             RowBox[{"perp", ",", "diag"}], "]"}], ",", 
            RowBox[{"getcol", "[", 
             RowBox[{"perp", ",", "diag"}], "]"}]}], "]"}], " ", 
          RowBox[{"area", "[", 
           RowBox[{"getrow", "[", 
            RowBox[{"perp", ",", "diag"}], "]"}], "]"}], " ", 
          RowBox[{"area", "[", 
           RowBox[{"getcol", "[", 
            RowBox[{"perp", ",", "diag"}], "]"}], "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", 
           SuperscriptBox["2", 
            RowBox[{"switch", "[", 
             RowBox[{"getrow", "[", 
              RowBox[{"perp", ",", "diag"}], "]"}], "]"}]], ",", "2"}], "}"}],
          ",", 
         RowBox[{"{", 
          RowBox[{"j", ",", "1", ",", 
           SuperscriptBox["2", 
            RowBox[{"switch", "[", 
             RowBox[{"getcol", "[", 
              RowBox[{"perp", ",", "diag"}], "]"}], "]"}]], ",", "2"}], 
          "}"}]}], "]"}], "\[IndentingNewLine]", ",", 
       RowBox[{"{", 
        RowBox[{"perp", ",", 
         RowBox[{"-", "1"}], ",", 
         RowBox[{"endperp", "[", "diag", "]"}]}], "}"}]}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"diag", ",", 
       RowBox[{"-", "1"}], ",", "n"}], "}"}]}], "]"}]}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"sparseBoundaryXIntegrate", "[", 
    RowBox[{"f_", ",", "n_"}], "]"}], ":=", "0"}], " ", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"do", " ", "later"}], ",", " ", 
    RowBox[{
    "if", " ", "you", " ", "find", " ", "a", " ", "better", " ", 
     "definition"}]}], "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"Sum", "[", 
    RowBox[{
     RowBox[{"Sum", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"posW", "[", "i", "]"}], 
        RowBox[{"posW", "[", "j", "]"}], " ", 
        FractionBox["1", 
         RowBox[{" ", 
          RowBox[{"GCD", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"2", "^", "n"}], " ", "i"}], ",", 
            RowBox[{"2", "^", 
             RowBox[{"(", "n", ")"}]}]}], "]"}]}]], 
        RowBox[{"1", "/", 
         RowBox[{"2", "^", "n"}]}], " ", 
        RowBox[{"f", "[", 
         RowBox[{"i", ",", " ", "j"}], " ", "]"}]}], ",", 
       RowBox[{"{", 
        RowBox[{"j", ",", "0", ",", "1", ",", 
         RowBox[{"1", "/", 
          RowBox[{"GCD", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"2", "^", "n"}], " ", "i"}], ",", 
            RowBox[{"2", "^", 
             RowBox[{"(", "n", ")"}]}]}], "]"}]}]}], "}"}]}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "0", ",", "1", ",", 
       RowBox[{"2", "^", 
        RowBox[{"(", 
         RowBox[{"-", "n"}], ")"}]}]}], "}"}]}], "]"}], "*)"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"The", " ", "area", " ", "weights"}], ",", " ", 
    RowBox[{"although", " ", "they", " ", "sum", " ", "to", " ", "1"}], ",", 
    " ", 
    RowBox[{
    "are", " ", "not", " ", "totally", " ", "right", " ", "for", " ", 
     "sparse", " ", "grids"}]}], "*)"}]}]}], "Input",
 CellChangeTimes->{{3.673913112737192*^9, 3.673913190086637*^9}, {
   3.6739132722211037`*^9, 3.673913412083212*^9}, {3.673913492566742*^9, 
   3.673913513414613*^9}, {3.673913586167919*^9, 3.673913593994001*^9}, {
   3.673913672965742*^9, 3.67391369223491*^9}, {3.67391377872025*^9, 
   3.6739137973109007`*^9}, {3.673913924793683*^9, 3.673914027240034*^9}, {
   3.673914160114106*^9, 3.673914221895009*^9}, {3.6739143916895742`*^9, 
   3.6739145331206093`*^9}, {3.673914594090477*^9, 3.673914610210465*^9}, {
   3.673914675219448*^9, 3.673914688962699*^9}, {3.673914833997225*^9, 
   3.673914867610242*^9}, {3.673914976578474*^9, 3.6739149854145193`*^9}, {
   3.673915022645698*^9, 3.6739150543556957`*^9}, {3.673915117319284*^9, 
   3.673915132081748*^9}, {3.673915279550877*^9, 3.673915293701923*^9}, {
   3.6739169166314077`*^9, 3.6739169534174833`*^9}, {3.673917107616473*^9, 
   3.673917107978497*^9}, {3.673917695473206*^9, 3.673917848938649*^9}, {
   3.673918823918103*^9, 3.673918843774968*^9}, {3.673918917040648*^9, 
   3.6739189194188137`*^9}, {3.673957920483602*^9, 3.673958038101882*^9}, 
   3.673958083722206*^9, {3.673958209451334*^9, 3.6739582140975237`*^9}, {
   3.673968265666698*^9, 3.673968303750602*^9}, {3.673976192172984*^9, 
   3.673976214066881*^9}, {3.673976578362255*^9, 3.673976661268655*^9}, {
   3.6739767007570972`*^9, 3.6739768429528637`*^9}, {3.673977141777309*^9, 
   3.673977191189653*^9}, {3.673978134518664*^9, 3.673978165469441*^9}, {
   3.673978308347847*^9, 3.673978318209403*^9}, {3.6739787649743958`*^9, 
   3.673978767252328*^9}, {3.673978877464623*^9, 3.673978883098538*^9}, {
   3.673980093499876*^9, 3.6739801249024353`*^9}, {3.673980995259432*^9, 
   3.673981023282233*^9}, {3.673981082272324*^9, 3.673981083133692*^9}, {
   3.6739811335714703`*^9, 3.673981138548029*^9}, {3.673981178883544*^9, 
   3.6739811847913237`*^9}, {3.67418052922116*^9, 3.674180529361578*^9}, {
   3.6741805990322866`*^9, 3.674180603818716*^9}, {3.674235656469858*^9, 
   3.67423565674017*^9}, {3.674312314684051*^9, 3.674312319193611*^9}, 
   3.674312408117704*^9, {3.674312909200194*^9, 3.674312919427949*^9}, {
   3.6743500278558397`*^9, 3.67435003116987*^9}, {3.67435010845201*^9, 
   3.674350115939509*^9}, {3.674350193092217*^9, 3.674350203464357*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Weights for the Sparse Grid", "Subsection",
 CellChangeTimes->{{3.673277052290266*^9, 3.673277061302971*^9}, {
  3.673277119209675*^9, 3.6732771212386723`*^9}, {3.673348508736053*^9, 
  3.673348513701818*^9}, {3.6737269924034224`*^9, 3.6737269925381393`*^9}, {
  3.6742149257106323`*^9, 3.674214930931775*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"weights1D", "[", 
    RowBox[{"i_", ",", "kx_", ",", "lx_"}], "]"}], ":=", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"Mod", "[", 
       RowBox[{"i", ",", 
        SuperscriptBox["2", 
         RowBox[{"lx", "-", "kx"}]]}], "]"}], "\[Equal]", "0"}], ",", 
     RowBox[{"switch3", "[", 
      RowBox[{"kx", ",", 
       RowBox[{
        SuperscriptBox["2", 
         RowBox[{"kx", "-", "lx"}]], "i"}]}], "]"}], ",", "0"}], "]"}]}], 
  "\n"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"showFullWeights", "[", 
    RowBox[{"lx_", ",", "ly_"}], "]"}], ":=", 
   RowBox[{"Sum", "[", 
    RowBox[{
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"weights1D", "[", 
         RowBox[{"i", ",", "kx", ",", "lx"}], "]"}], " ", 
        RowBox[{"weights1D", "[", 
         RowBox[{"j", ",", "ky", ",", "ly"}], "]"}]}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "0", ",", 
         SuperscriptBox["2", "lx"]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"j", ",", "0", ",", 
         SuperscriptBox["2", "ly"]}], "}"}]}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"kx", ",", "0", ",", "lx"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"ky", ",", "0", ",", "ly"}], "}"}]}], "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"showSparseWeights", "[", "n_", "]"}], ":=", 
  RowBox[{
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"weights1D", "[", 
       RowBox[{"i", ",", "0", ",", "n"}], "]"}], " ", 
      RowBox[{"weights1D", "[", 
       RowBox[{"j", ",", "0", ",", "n"}], "]"}]}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "0", ",", 
       SuperscriptBox["2", "n"]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"j", ",", "0", ",", 
       SuperscriptBox["2", "n"]}], "}"}]}], "]"}], "+", 
   RowBox[{"Sum", "[", 
    RowBox[{
     RowBox[{"Sum", "[", 
      RowBox[{
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"weights1D", "[", 
           RowBox[{"i", ",", 
            RowBox[{"Max", "[", 
             RowBox[{"0", ",", 
              RowBox[{"getrow", "[", 
               RowBox[{"perp", ",", "diag"}], "]"}]}], "]"}], ",", "n"}], 
           "]"}], 
          RowBox[{"weights1D", "[", 
           RowBox[{"j", ",", 
            RowBox[{"Max", "[", 
             RowBox[{"0", ",", 
              RowBox[{"getcol", "[", 
               RowBox[{"perp", ",", "diag"}], "]"}]}], "]"}], ",", "n"}], 
           "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "0", ",", 
           SuperscriptBox["2", "n"]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"j", ",", "0", ",", 
           SuperscriptBox["2", "n"]}], "}"}]}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"perp", ",", 
         RowBox[{"-", "1"}], ",", 
         RowBox[{"endperp", "[", "diag", "]"}]}], "}"}]}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"diag", ",", "1", ",", "n"}], "}"}]}], "]"}]}]}]}], "Input",
 CellChangeTimes->{{3.674214215951852*^9, 3.674214236340961*^9}, {
  3.674214267738717*^9, 3.674214293639688*^9}, {3.674214339125592*^9, 
  3.674214342627858*^9}, {3.6742149617240562`*^9, 3.674214971859111*^9}, {
  3.6742150632155437`*^9, 3.674215088826158*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Redefining differentiation (Sparse Differentiation)", "Subsection",
 CellChangeTimes->{{3.673277052290266*^9, 3.673277061302971*^9}, {
  3.673277119209675*^9, 3.6732771212386723`*^9}, {3.673348508736053*^9, 
  3.673348513701818*^9}, {3.6737269924034224`*^9, 3.6737269925381393`*^9}, {
  3.6743022367902737`*^9, 3.674302248244155*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"sparseDiffx", "[", 
    RowBox[{"f_", ",", "n_", ",", "kx_", ",", "ky_", ",", "i_", ",", "j_"}], 
    "]"}], ":=", 
   RowBox[{
    RowBox[{"Which", "[", 
     RowBox[{
      RowBox[{"#1", "<", " ", 
       RowBox[{"2", "^", 
        RowBox[{"-", "n"}]}]}], ",", 
      FractionBox[
       RowBox[{
        RowBox[{"f", "[", 
         RowBox[{
          RowBox[{"#1", "+", 
           SuperscriptBox["2", 
            RowBox[{"-", "l"}]]}], ",", "#2"}], "]"}], "-", 
        RowBox[{"f", "[", 
         RowBox[{"#1", ",", "#2"}], "]"}]}], 
       SuperscriptBox["2", 
        RowBox[{"-", "l"}]]], ",", 
      RowBox[{"#1", ">", 
       RowBox[{"1", "-", 
        RowBox[{"2", "^", 
         RowBox[{"-", "n"}]}]}]}], " ", ",", 
      FractionBox[
       RowBox[{
        RowBox[{"f", "[", 
         RowBox[{"#1", ",", "#2"}], "]"}], "-", 
        RowBox[{"f", "[", 
         RowBox[{
          RowBox[{"#1", "-", 
           SuperscriptBox["2", 
            RowBox[{"-", "l"}]]}], ",", "#2"}], "]"}]}], 
       SuperscriptBox["2", 
        RowBox[{"-", "l"}]]], ",", "True", ",", 
      FractionBox[
       RowBox[{
        RowBox[{"f", "[", 
         RowBox[{
          RowBox[{"#1", "+", 
           SuperscriptBox["2", 
            RowBox[{"-", "l"}]]}], ",", "#2"}], "]"}], "-", 
        RowBox[{"f", "[", 
         RowBox[{
          RowBox[{"#1", "-", 
           SuperscriptBox["2", 
            RowBox[{"-", "l"}]]}], ",", "#2"}], "]"}]}], 
       RowBox[{"2", " ", 
        SuperscriptBox["2", 
         RowBox[{"-", "l"}]]}]]}], " ", "]"}], "&"}]}], "\[IndentingNewLine]",
   "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"sparseDiffy", "[", 
   RowBox[{"f_", ",", "l_"}], "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"Which", "[", 
    RowBox[{
     RowBox[{"#2", "<", " ", 
      SuperscriptBox["2", 
       RowBox[{"-", "l"}]]}], ",", 
     FractionBox[
      RowBox[{
       RowBox[{"f", "[", 
        RowBox[{"#1", ",", 
         RowBox[{"#2", "+", 
          SuperscriptBox["2", 
           RowBox[{"-", "l"}]]}]}], "]"}], "-", 
       RowBox[{"f", "[", 
        RowBox[{"#1", ",", "#2"}], "]"}]}], 
      SuperscriptBox["2", 
       RowBox[{"-", "l"}]]], ",", 
     RowBox[{"#2", ">", " ", 
      RowBox[{"1", "-", 
       SuperscriptBox["2", 
        RowBox[{"-", "l"}]]}]}], ",", 
     FractionBox[
      RowBox[{
       RowBox[{"f", "[", 
        RowBox[{"#1", ",", "#2"}], "]"}], "-", 
       RowBox[{"f", "[", 
        RowBox[{"#1", ",", 
         RowBox[{"#2", "-", 
          SuperscriptBox["2", 
           RowBox[{"-", "l"}]]}]}], "]"}]}], 
      SuperscriptBox["2", 
       RowBox[{"-", "l"}]]], ",", "True", ",", 
     FractionBox[
      RowBox[{
       RowBox[{"f", "[", 
        RowBox[{"#1", ",", 
         RowBox[{"#2", "+", 
          SuperscriptBox["2", 
           RowBox[{"-", "l"}]]}]}], "]"}], "-", 
       RowBox[{"f", "[", 
        RowBox[{"#1", ",", 
         RowBox[{"#2", "-", 
          SuperscriptBox["2", 
           RowBox[{"-", "l"}]]}]}], "]"}]}], 
      RowBox[{"2", " ", 
       SuperscriptBox["2", 
        RowBox[{"-", "l"}]]}]]}], "]"}], "&"}]}]}], "Input",
 CellChangeTimes->CompressedData["
1:eJxTTMoPSmViYGAQB2IQvXeFs4xA3GvH4mYmHRBdVN1bDKLTNrGUgOifC7yq
QfQ/Xb9aEP1r+c+pIHreRqdpILpuxsTZIDqO9RiYlmv/tRBEN3ysWgSi96XN
2wii7+c+2gSi9dkPaJoBabbjJlogmkkoKvQpkE4o3pkEopn+z8oC0RoLkrJB
9De+KR2vgXRuKmsniN4aL+iYGA80Z1k+mJ5R8yMIRD/R3xICojdoHM9IAtIa
LJ8yQfSBzXwaaUD6xK8uTRBtd+qSKYgOvHPdGkSzMFo5gegtbN/A9L4yB/ZW
IF1W4wamUzqmHv0IpO+99z0OojnaCtg+A+mq90XcILrAgf+5TsJrR+Zzum9B
dITd7ghdIM3VKB4Jop8IBcWDaIfuy2AaAOKerq4=
  "]]
}, Open  ]]
},
WindowSize->{998, 651},
WindowMargins->{{Automatic, -464}, {Automatic, 0}},
FrontEndVersion->"10.4 for Mac OS X x86 (32-bit, 64-bit Kernel) (February 25, \
2016)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 110, 1, 44, "Subsection"],
Cell[693, 25, 12534, 365, 671, "Code",
 InitializationCell->False]
}, Open  ]],
Cell[CellGroupData[{
Cell[13264, 395, 237, 3, 44, "Subsection"],
Cell[13504, 400, 6480, 154, 279, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[20021, 559, 262, 3, 44, "Subsection"],
Cell[20286, 564, 4981, 122, 402, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[25304, 691, 220, 3, 44, "Subsection"],
Cell[25527, 696, 13666, 294, 310, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[39230, 995, 146, 2, 44, "Subsection"],
Cell[39379, 999, 12737, 275, 627, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[52153, 1279, 254, 3, 44, "Subsection"],
Cell[52410, 1284, 9666, 218, 723, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[62113, 1507, 100, 1, 44, "Subsection"],
Cell[62216, 1510, 11283, 245, 645, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[73536, 1760, 154, 2, 44, "Subsection"],
Cell[73693, 1764, 7791, 192, 438, "Input"],
Cell[81487, 1958, 203, 5, 28, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[81727, 1968, 357, 5, 44, "Subsection"],
Cell[82087, 1975, 1196, 34, 57, "Input"],
Cell[83286, 2011, 1511, 43, 95, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[84834, 2059, 315, 4, 44, "Subsection"],
Cell[85152, 2065, 9991, 250, 574, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[95180, 2320, 316, 4, 44, "Subsection"],
Cell[95499, 2326, 3311, 94, 176, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[98847, 2425, 340, 4, 44, "Subsection"],
Cell[99190, 2431, 3647, 112, 259, "Input"]
}, Open  ]]
}
]
*)

